<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Heatmap Annotations | ComplexHeatmap Complete Reference</title>
  <meta name="description" content="Complex heatmaps are efficient to visualize associations between different sources of data sets and reveal potential patterns. Here the ComplexHeatmap R package provides a highly flexible way to arrange multiple heatmaps and supports various annotation graphics. This book is the complete reference to ComplexHeatmap pacakge." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Heatmap Annotations | ComplexHeatmap Complete Reference" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://jokergoo.github.io/ComplexHeatmap-reference/book" />
  <meta property="og:image" content="https://jokergoo.github.io/ComplexHeatmap-reference/bookcomplexheatmap-cover.jpg" />
  <meta property="og:description" content="Complex heatmaps are efficient to visualize associations between different sources of data sets and reveal potential patterns. Here the ComplexHeatmap R package provides a highly flexible way to arrange multiple heatmaps and supports various annotation graphics. This book is the complete reference to ComplexHeatmap pacakge." />
  <meta name="github-repo" content="jokergoo/ComplexHeatmap-reference" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Heatmap Annotations | ComplexHeatmap Complete Reference" />
  
  <meta name="twitter:description" content="Complex heatmaps are efficient to visualize associations between different sources of data sets and reveal potential patterns. Here the ComplexHeatmap R package provides a highly flexible way to arrange multiple heatmaps and supports various annotation graphics. This book is the complete reference to ComplexHeatmap pacakge." />
  <meta name="twitter:image" content="https://jokergoo.github.io/ComplexHeatmap-reference/bookcomplexheatmap-cover.jpg" />

<meta name="author" content="Zuguang Gu" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="a-single-heatmap.html"/>
<link rel="next" href="a-list-of-heatmaps.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ComplexHeatmap Complete Reference</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#general-design"><i class="fa fa-check"></i><b>1.1</b> General design</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#a-brief-description-of-following-chapters"><i class="fa fa-check"></i><b>1.2</b> A brief description of following chapters</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html"><i class="fa fa-check"></i><b>2</b> A Single Heatmap</a><ul>
<li class="chapter" data-level="2.1" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#colors"><i class="fa fa-check"></i><b>2.1</b> Colors</a></li>
<li class="chapter" data-level="2.2" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#heatmap-titles"><i class="fa fa-check"></i><b>2.2</b> Titles</a></li>
<li class="chapter" data-level="2.3" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#clustering"><i class="fa fa-check"></i><b>2.3</b> Clustering</a><ul>
<li class="chapter" data-level="2.3.1" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#distance-methods"><i class="fa fa-check"></i><b>2.3.1</b> Distance methods</a></li>
<li class="chapter" data-level="2.3.2" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#clustering-methods"><i class="fa fa-check"></i><b>2.3.2</b> Clustering methods</a></li>
<li class="chapter" data-level="2.3.3" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#render-dendrograms"><i class="fa fa-check"></i><b>2.3.3</b> Render dendrograms</a></li>
<li class="chapter" data-level="2.3.4" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#reorder-dendrograms"><i class="fa fa-check"></i><b>2.3.4</b> Reorder dendrograms</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#row-and_column_orders"><i class="fa fa-check"></i><b>2.4</b> Set row and column orders</a></li>
<li class="chapter" data-level="2.5" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#heatmap-seriation"><i class="fa fa-check"></i><b>2.5</b> Seriation</a></li>
<li class="chapter" data-level="2.6" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#dimension-names"><i class="fa fa-check"></i><b>2.6</b> Dimension names</a></li>
<li class="chapter" data-level="2.7" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#heatmap-split"><i class="fa fa-check"></i><b>2.7</b> Heatmap split</a><ul>
<li class="chapter" data-level="2.7.1" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#split-by-kmeans-clustering"><i class="fa fa-check"></i><b>2.7.1</b> Split by k-means clustering</a></li>
<li class="chapter" data-level="2.7.2" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#split-by-categorical-variables"><i class="fa fa-check"></i><b>2.7.2</b> Split by categorical variables</a></li>
<li class="chapter" data-level="2.7.3" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#spilt-by-dendrogram"><i class="fa fa-check"></i><b>2.7.3</b> Split by dendrogram</a></li>
<li class="chapter" data-level="2.7.4" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#order-of-slices"><i class="fa fa-check"></i><b>2.7.4</b> Order of slices</a></li>
<li class="chapter" data-level="2.7.5" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#titles-for-splitting"><i class="fa fa-check"></i><b>2.7.5</b> Titles for splitting</a></li>
<li class="chapter" data-level="2.7.6" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#graphic-parameters-for-splitting"><i class="fa fa-check"></i><b>2.7.6</b> Graphic parameters for splitting</a></li>
<li class="chapter" data-level="2.7.7" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#gaps-between-slices"><i class="fa fa-check"></i><b>2.7.7</b> Gaps between slices</a></li>
<li class="chapter" data-level="2.7.8" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#split-heatmap-annotations"><i class="fa fa-check"></i><b>2.7.8</b> Split heatmap annotations</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#heatmap-as-raster-image"><i class="fa fa-check"></i><b>2.8</b> Heatmap as raster image</a></li>
<li class="chapter" data-level="2.9" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#customize-the-heatmap-body"><i class="fa fa-check"></i><b>2.9</b> Customize the heatmap body</a><ul>
<li class="chapter" data-level="2.9.1" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#cell-fun"><i class="fa fa-check"></i><b>2.9.1</b> cell_fun</a></li>
<li class="chapter" data-level="2.9.2" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#layer-fun"><i class="fa fa-check"></i><b>2.9.2</b> layer_fun</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#size-of-the-heatmap"><i class="fa fa-check"></i><b>2.10</b> Size of the heatmap</a></li>
<li class="chapter" data-level="2.11" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#plot-the-heatmap"><i class="fa fa-check"></i><b>2.11</b> Plot the heatmap</a></li>
<li class="chapter" data-level="2.12" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#get-orders-and-dendrograms-from-heatmap"><i class="fa fa-check"></i><b>2.12</b> Get orders and dendrograms</a></li>
<li class="chapter" data-level="2.13" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#subset-a-heatmap"><i class="fa fa-check"></i><b>2.13</b> Subset a heatmap</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html"><i class="fa fa-check"></i><b>3</b> Heatmap Annotations</a><ul>
<li class="chapter" data-level="3.1" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#simple-annotation"><i class="fa fa-check"></i><b>3.1</b> Simple annotation</a></li>
<li class="chapter" data-level="3.2" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#simple-annotation-as-an-annotation-function"><i class="fa fa-check"></i><b>3.2</b> Simple annotation as an annotation function</a></li>
<li class="chapter" data-level="3.3" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#empty-annotation"><i class="fa fa-check"></i><b>3.3</b> Empty annotation</a></li>
<li class="chapter" data-level="3.4" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#block-annotation"><i class="fa fa-check"></i><b>3.4</b> Block annotation</a></li>
<li class="chapter" data-level="3.5" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#image-annotation"><i class="fa fa-check"></i><b>3.5</b> Image annotation</a></li>
<li class="chapter" data-level="3.6" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#points-annotation"><i class="fa fa-check"></i><b>3.6</b> Points annotation</a></li>
<li class="chapter" data-level="3.7" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#lines-annotation"><i class="fa fa-check"></i><b>3.7</b> Lines annotation</a></li>
<li class="chapter" data-level="3.8" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#barplot_annotation"><i class="fa fa-check"></i><b>3.8</b> Barplot annotation</a></li>
<li class="chapter" data-level="3.9" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#box-annotation"><i class="fa fa-check"></i><b>3.9</b> Boxplot annotation</a></li>
<li class="chapter" data-level="3.10" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#histogram-annotation"><i class="fa fa-check"></i><b>3.10</b> Histogram annotation</a></li>
<li class="chapter" data-level="3.11" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#density-annotation"><i class="fa fa-check"></i><b>3.11</b> Density annotation</a></li>
<li class="chapter" data-level="3.12" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#joyplot-annotation"><i class="fa fa-check"></i><b>3.12</b> Joyplot annotation</a></li>
<li class="chapter" data-level="3.13" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#horizon-chart-annotation"><i class="fa fa-check"></i><b>3.13</b> Horizon chart annotation</a></li>
<li class="chapter" data-level="3.14" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#text-annotation"><i class="fa fa-check"></i><b>3.14</b> Text annotation</a></li>
<li class="chapter" data-level="3.15" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#mark-annotation"><i class="fa fa-check"></i><b>3.15</b> Mark annotation</a></li>
<li class="chapter" data-level="3.16" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#summary-annotation"><i class="fa fa-check"></i><b>3.16</b> Summary annotation</a></li>
<li class="chapter" data-level="3.17" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#zoom-annotation"><i class="fa fa-check"></i><b>3.17</b> Zoom/link annotation</a></li>
<li class="chapter" data-level="3.18" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#multiple-annotations"><i class="fa fa-check"></i><b>3.18</b> Multiple annotations</a><ul>
<li class="chapter" data-level="3.18.1" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#size-of-annotations"><i class="fa fa-check"></i><b>3.18.1</b> Size of annotations</a></li>
<li class="chapter" data-level="3.18.2" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#annotation-labels"><i class="fa fa-check"></i><b>3.18.2</b> Annotation labels</a></li>
</ul></li>
<li class="chapter" data-level="3.19" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#heatmap-annotation-utility-function"><i class="fa fa-check"></i><b>3.19</b> Utility functions</a></li>
<li class="chapter" data-level="3.20" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#implement-new-annotation-functions"><i class="fa fa-check"></i><b>3.20</b> Implement new annotation functions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html"><i class="fa fa-check"></i><b>4</b> A List of Heatmaps</a><ul>
<li class="chapter" data-level="4.1" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#heatmap-list-titles"><i class="fa fa-check"></i><b>4.1</b> Titles</a></li>
<li class="chapter" data-level="4.2" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#size-of-heatmaps"><i class="fa fa-check"></i><b>4.2</b> Size of heatmaps</a></li>
<li class="chapter" data-level="4.3" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#gap-between-heatmaps"><i class="fa fa-check"></i><b>4.3</b> Gap between heatmaps</a></li>
<li class="chapter" data-level="4.4" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#automatic-adjustment-to-the-main-heatmap"><i class="fa fa-check"></i><b>4.4</b> Automatic adjustment to the main heatmap</a></li>
<li class="chapter" data-level="4.5" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#control-main-heatmap-in-draw-function"><i class="fa fa-check"></i><b>4.5</b> Control main heatmap in draw() function</a></li>
<li class="chapter" data-level="4.6" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#annotations-as-components-are-adjusted"><i class="fa fa-check"></i><b>4.6</b> Annotations as components are adjusted</a></li>
<li class="chapter" data-level="4.7" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#concatenate-with-annotations"><i class="fa fa-check"></i><b>4.7</b> Concatenate with annotations</a></li>
<li class="chapter" data-level="4.8" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#concatenate-only-the-annotations"><i class="fa fa-check"></i><b>4.8</b> Concatenate only the annotations</a></li>
<li class="chapter" data-level="4.9" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#vertical-concatenation"><i class="fa fa-check"></i><b>4.9</b> Vertical concatenation</a></li>
<li class="chapter" data-level="4.10" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#subset-heatmap-list"><i class="fa fa-check"></i><b>4.10</b> Subset the heatmap list</a></li>
<li class="chapter" data-level="4.11" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#plot-the-heamtap-list"><i class="fa fa-check"></i><b>4.11</b> Plot the heatmap list</a></li>
<li class="chapter" data-level="4.12" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#get-orders-and-dendrograms-from-a-list-of-heatmaps"><i class="fa fa-check"></i><b>4.12</b> Get orders and dendrograms</a></li>
<li class="chapter" data-level="4.13" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#change-parameters-globally"><i class="fa fa-check"></i><b>4.13</b> Change parameters globally</a></li>
<li class="chapter" data-level="4.14" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#adjust-blank-space-caused-by-annotations"><i class="fa fa-check"></i><b>4.14</b> Adjust blank space caused by annotations</a></li>
<li class="chapter" data-level="4.15" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#manually-increase-space-around-the-plot"><i class="fa fa-check"></i><b>4.15</b> Manually increase space around the plot</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="legends.html"><a href="legends.html"><i class="fa fa-check"></i><b>5</b> Legends</a><ul>
<li class="chapter" data-level="5.1" data-path="legends.html"><a href="legends.html#continuous-legends"><i class="fa fa-check"></i><b>5.1</b> Continuous legends</a></li>
<li class="chapter" data-level="5.2" data-path="legends.html"><a href="legends.html#discrete-legends"><i class="fa fa-check"></i><b>5.2</b> Discrete legends</a></li>
<li class="chapter" data-level="5.3" data-path="legends.html"><a href="legends.html#a-list-of-legends"><i class="fa fa-check"></i><b>5.3</b> A list of legends</a></li>
<li class="chapter" data-level="5.4" data-path="legends.html"><a href="legends.html#heatmap-and-annotation-legends"><i class="fa fa-check"></i><b>5.4</b> Heatmap and annotation legends</a></li>
<li class="chapter" data-level="5.5" data-path="legends.html"><a href="legends.html#add-customized-legends"><i class="fa fa-check"></i><b>5.5</b> Add customized legends</a></li>
<li class="chapter" data-level="5.6" data-path="legends.html"><a href="legends.html#the-side-of-legends"><i class="fa fa-check"></i><b>5.6</b> The side of legends</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html"><i class="fa fa-check"></i><b>6</b> Heatmap Decoration</a><ul>
<li class="chapter" data-level="6.1" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html#decoration-functions"><i class="fa fa-check"></i><b>6.1</b> Decoration functions</a></li>
<li class="chapter" data-level="6.2" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html#decoration-examples"><i class="fa fa-check"></i><b>6.2</b> Examples</a><ul>
<li class="chapter" data-level="6.2.1" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html#barplot-for-single-column-heatmap"><i class="fa fa-check"></i><b>6.2.1</b> Barplot for single-column heatmap</a></li>
<li class="chapter" data-level="6.2.2" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html#add-titles-for-row-annotations"><i class="fa fa-check"></i><b>6.2.2</b> Add titles for row annotations</a></li>
<li class="chapter" data-level="6.2.3" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html#other-possible-use-of-decorations"><i class="fa fa-check"></i><b>6.2.3</b> Other possible use of decorations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="oncoprint.html"><a href="oncoprint.html"><i class="fa fa-check"></i><b>7</b> OncoPrint</a><ul>
<li class="chapter" data-level="7.1" data-path="oncoprint.html"><a href="oncoprint.html#oncoprint-general-settings"><i class="fa fa-check"></i><b>7.1</b> General settings</a><ul>
<li class="chapter" data-level="7.1.1" data-path="oncoprint.html"><a href="oncoprint.html#input-data-format"><i class="fa fa-check"></i><b>7.1.1</b> Input data format</a></li>
<li class="chapter" data-level="7.1.2" data-path="oncoprint.html"><a href="oncoprint.html#define-the-alter-fun"><i class="fa fa-check"></i><b>7.1.2</b> Define the alter_fun()</a></li>
<li class="chapter" data-level="7.1.3" data-path="oncoprint.html"><a href="oncoprint.html#oncoprint-background"><i class="fa fa-check"></i><b>7.1.3</b> Background</a></li>
<li class="chapter" data-level="7.1.4" data-path="oncoprint.html"><a href="oncoprint.html#complex-alteration-types"><i class="fa fa-check"></i><b>7.1.4</b> Complex alteration types</a></li>
<li class="chapter" data-level="7.1.5" data-path="oncoprint.html"><a href="oncoprint.html#simplify-alter_fun"><i class="fa fa-check"></i><b>7.1.5</b> Simplify alter_fun</a></li>
<li class="chapter" data-level="7.1.6" data-path="oncoprint.html"><a href="oncoprint.html#other-heatmap-related-settings"><i class="fa fa-check"></i><b>7.1.6</b> Other heatmap-related settings</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="oncoprint.html"><a href="oncoprint.html#apply-to-cbioportal-dataset"><i class="fa fa-check"></i><b>7.2</b> Apply to cBioPortal dataset</a><ul>
<li class="chapter" data-level="7.2.1" data-path="oncoprint.html"><a href="oncoprint.html#remove-empty-rows-and-columns"><i class="fa fa-check"></i><b>7.2.1</b> Remove empty rows and columns</a></li>
<li class="chapter" data-level="7.2.2" data-path="oncoprint.html"><a href="oncoprint.html#reorder-the-oncoprint"><i class="fa fa-check"></i><b>7.2.2</b> Reorder the oncoPrint</a></li>
<li class="chapter" data-level="7.2.3" data-path="oncoprint.html"><a href="oncoprint.html#oncoprint-annotations"><i class="fa fa-check"></i><b>7.2.3</b> OncoPrint annotations</a></li>
<li class="chapter" data-level="7.2.4" data-path="oncoprint.html"><a href="oncoprint.html#oncoprint-as-a-heatmap"><i class="fa fa-check"></i><b>7.2.4</b> oncoPrint as a Heatmap</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="upset-plot.html"><a href="upset-plot.html"><i class="fa fa-check"></i><b>8</b> UpSet plot</a><ul>
<li class="chapter" data-level="8.1" data-path="upset-plot.html"><a href="upset-plot.html#input-data"><i class="fa fa-check"></i><b>8.1</b> Input data</a></li>
<li class="chapter" data-level="8.2" data-path="upset-plot.html"><a href="upset-plot.html#upset-mode"><i class="fa fa-check"></i><b>8.2</b> Mode</a></li>
<li class="chapter" data-level="8.3" data-path="upset-plot.html"><a href="upset-plot.html#make-the-combination-matrix"><i class="fa fa-check"></i><b>8.3</b> Make the combination matrix</a></li>
<li class="chapter" data-level="8.4" data-path="upset-plot.html"><a href="upset-plot.html#upset-utility-functions"><i class="fa fa-check"></i><b>8.4</b> Utility functions</a></li>
<li class="chapter" data-level="8.5" data-path="upset-plot.html"><a href="upset-plot.html#upset-making-the-plot"><i class="fa fa-check"></i><b>8.5</b> Make the plot</a></li>
<li class="chapter" data-level="8.6" data-path="upset-plot.html"><a href="upset-plot.html#upset-plots-as-heatmaps"><i class="fa fa-check"></i><b>8.6</b> UpSet plots as heatmaps</a></li>
<li class="chapter" data-level="8.7" data-path="upset-plot.html"><a href="upset-plot.html#example-with-the-movies-dataset"><i class="fa fa-check"></i><b>8.7</b> Example with the movies dataset</a></li>
<li class="chapter" data-level="8.8" data-path="upset-plot.html"><a href="upset-plot.html#example-with-the-genomic-regions"><i class="fa fa-check"></i><b>8.8</b> Example with the genomic regions</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="more-examples.html"><a href="more-examples.html"><i class="fa fa-check"></i><b>9</b> More Examples</a><ul>
<li class="chapter" data-level="9.1" data-path="more-examples.html"><a href="more-examples.html#add-more-information-for-gene-expression-matrix"><i class="fa fa-check"></i><b>9.1</b> Add more information for gene expression matrix</a></li>
<li class="chapter" data-level="9.2" data-path="more-examples.html"><a href="more-examples.html#the-measles-vaccine-heatmap"><i class="fa fa-check"></i><b>9.2</b> The measles vaccine heatmap</a></li>
<li class="chapter" data-level="9.3" data-path="more-examples.html"><a href="more-examples.html#visualize-cell-heterogeneity-from-single-cell-rnaseq"><i class="fa fa-check"></i><b>9.3</b> Visualize Cell Heterogeneity from Single Cell RNASeq</a></li>
<li class="chapter" data-level="9.4" data-path="more-examples.html"><a href="more-examples.html#correlations-between-methylation-expression-and-other-genomic-features"><i class="fa fa-check"></i><b>9.4</b> Correlations between methylation, expression and other genomic features</a></li>
<li class="chapter" data-level="9.5" data-path="more-examples.html"><a href="more-examples.html#visualize-methylation-profile-with-complex-annotations"><i class="fa fa-check"></i><b>9.5</b> Visualize Methylation Profile with Complex Annotations</a></li>
<li class="chapter" data-level="9.6" data-path="more-examples.html"><a href="more-examples.html#add-multiple-boxplots-for-single-row"><i class="fa fa-check"></i><b>9.6</b> Add multiple boxplots for single row</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="other-high-level-plots.html"><a href="other-high-level-plots.html"><i class="fa fa-check"></i><b>10</b> Other High-level Plots</a><ul>
<li class="chapter" data-level="10.1" data-path="other-high-level-plots.html"><a href="other-high-level-plots.html#density-heatmap"><i class="fa fa-check"></i><b>10.1</b> Density heatmap</a></li>
<li class="chapter" data-level="10.2" data-path="other-high-level-plots.html"><a href="other-high-level-plots.html#stacked-summary-plot"><i class="fa fa-check"></i><b>10.2</b> Stacked summary plot</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="other-tricks.html"><a href="other-tricks.html"><i class="fa fa-check"></i><b>11</b> Other Tricks</a><ul>
<li class="chapter" data-level="11.1" data-path="other-tricks.html"><a href="other-tricks.html#set-the-same-cell-size-for-different-heatmaps-with-different-dimensions"><i class="fa fa-check"></i><b>11.1</b> Set the same cell size for different heatmaps with different dimensions</a></li>
<li class="chapter" data-level="11.2" data-path="other-tricks.html"><a href="other-tricks.html#integrate-with-gridtext-package"><i class="fa fa-check"></i><b>11.2</b> Integrate with gridtext package</a><ul>
<li class="chapter" data-level="11.2.1" data-path="other-tricks.html"><a href="other-tricks.html#titles"><i class="fa fa-check"></i><b>11.2.1</b> Titles</a></li>
<li class="chapter" data-level="11.2.2" data-path="other-tricks.html"><a href="other-tricks.html#rowcolumn-names"><i class="fa fa-check"></i><b>11.2.2</b> Row/column names</a></li>
<li class="chapter" data-level="11.2.3" data-path="other-tricks.html"><a href="other-tricks.html#annotation-labels-1"><i class="fa fa-check"></i><b>11.2.3</b> Annotation labels</a></li>
<li class="chapter" data-level="11.2.4" data-path="other-tricks.html"><a href="other-tricks.html#text-annotation-1"><i class="fa fa-check"></i><b>11.2.4</b> Text annotation</a></li>
<li class="chapter" data-level="11.2.5" data-path="other-tricks.html"><a href="other-tricks.html#legend"><i class="fa fa-check"></i><b>11.2.5</b> Legend</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">ComplexHeatmap Complete Reference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="heatmap-annotations" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Heatmap Annotations</h1>
<p>Heatmap annotations are important components of a heatmap that it shows
additional information that associates with rows or columns in the heatmap.
<strong>ComplexHeatmap</strong> package provides very flexible supports for setting
annotations and defining new annotation graphics. The annotations can be put
on the four sides of the heatmap, by <code>top_annotation</code>, <code>bottom_annotation</code>,
<code>left_annotation</code> and <code>right_annotation</code> arguments.</p>
<p>The value for the four arguments should be in the <code>HeatmapAnnotation</code> class
and should be constructed by <code>HeatmapAnnotation()</code> function, or by
<code>rowAnnotation()</code> function if it is a row annotation. (<code>rowAnnotation()</code> is
just a helper function which is identical to <code>HeatmapAnnotation(..., which = &quot;row&quot;)</code>) A simple usage of heatmap annotations is as follows.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb164-2" data-line-number="2">mat =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb164-3" data-line-number="3"><span class="kw">rownames</span>(mat) =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;R&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb164-4" data-line-number="4"><span class="kw">colnames</span>(mat) =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;C&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb164-5" data-line-number="5">column_ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo1 =</span> <span class="kw">runif</span>(<span class="dv">10</span>), <span class="dt">bar1 =</span> <span class="kw">anno_barplot</span>(<span class="kw">runif</span>(<span class="dv">10</span>)))</a>
<a class="sourceLine" id="cb164-6" data-line-number="6">row_ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo2 =</span> <span class="kw">runif</span>(<span class="dv">10</span>), <span class="dt">bar2 =</span> <span class="kw">anno_barplot</span>(<span class="kw">runif</span>(<span class="dv">10</span>)))</a>
<a class="sourceLine" id="cb164-7" data-line-number="7"><span class="kw">Heatmap</span>(mat, <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>, <span class="dt">top_annotation =</span> column_ha, <span class="dt">right_annotation =</span> row_ha)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-3-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Or assign as bottom annotation and left annotation.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1"><span class="kw">Heatmap</span>(mat, <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>, <span class="dt">bottom_annotation =</span> column_ha, <span class="dt">left_annotation =</span> row_ha)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>In above examples, <code>column_ha</code> and <code>row_ha</code> both have two annotations where
<code>foo1</code> and <code>foo2</code> are numeric vectors and <code>bar1</code> and <code>bar2</code> are barplots. The
vector-like annotation is called <em>“simple annotation”</em> here and the barplot
annotation is called <em>“complex annotation”</em>. You can already see the
annotations must be defined as name-value pairs (e.g. <code>foo = ...</code>).</p>
<p>Heatmap annotations can also be independent of the heatmaps. They can be
concatenated to the heatmap list by <code>+</code> if it is horizontal or <code>%v%</code> if it is
vertical. Chapter <a href="a-list-of-heatmaps.html#a-list-of-heatmaps">4</a> will discuss how to concatenate
heatmaps and annotations.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" data-line-number="1"><span class="co"># code only for demonstration</span></a>
<a class="sourceLine" id="cb166-2" data-line-number="2"><span class="kw">Heatmap</span>(...) <span class="op">+</span><span class="st"> </span><span class="kw">rowAnnotation</span>() <span class="op">+</span><span class="st"> </span>...</a>
<a class="sourceLine" id="cb166-3" data-line-number="3"><span class="kw">Heatmap</span>(...) <span class="op">%v%</span><span class="st"> </span><span class="kw">HeatmapAnnotation</span>(...) <span class="op">+</span><span class="st"> </span>...</a></code></pre></div>
<p><code>HeatmapAnnotation()</code> returns a <code>HeatmapAnnotation</code> class object. The object
is usually composed of several annotations. If following sections of this
chapter, we first introduce settings for individal annotation, and later we
show how to put them toghether.</p>
<p>You can see the information of the <code>column_ha</code> and <code>row_ha</code> objects:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1">column_ha</a></code></pre></div>
<pre><code>## A HeatmapAnnotation object with 2 annotations
##   name: heatmap_annotation_0 
##   position: column 
##   items: 10 
##   width: 1npc 
##   height: 15.3514598035146mm 
##   this object is subsetable
##   0mm extension on the bottom 
##   5.92288888888889mm extension on the left 
##   0mm extension on the top 
##   9.4709mm extension on the right 
## 
##  name   annotation_type color_mapping height
##  foo1 continuous vector        random    5mm
##  bar1    anno_barplot()                 10mm</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" data-line-number="1">row_ha</a></code></pre></div>
<pre><code>## A HeatmapAnnotation object with 2 annotations
##   name: heatmap_annotation_1 
##   position: row 
##   items: 10 
##   width: 15.3514598035146mm 
##   height: 1npc 
##   this object is subsetable
##   9.96242222222223mm extension on the bottom 
##   0mm extension on the left 
##   0mm extension on the top 
##   0mm extension on the right 
## 
##  name   annotation_type color_mapping width
##  foo2 continuous vector        random   5mm
##  bar2    anno_barplot()                10mm</code></pre>
<p>In following examples in this chapter, we will only show the graphics for the
annotations with no heatmap, unless it is necessary. If you want to try it
with a heatmap, you just assign the <code>HeatmapAnnotation</code> object which we always
name as <code>ha</code> to <code>top_annotation</code>, <code>bottom_annotation</code>, <code>left_annotation</code> or
<code>right_annotation</code> arguments.</p>
<p>Settings are basically the same for column annotations and row annotations. If
there is nothing specicial, we only show the column annotation as examples. If
you want to try row annotation, just add <code>which = &quot;row&quot;</code> to
<code>HeatmapAnnotation()</code> or directly change to <code>rowAnnotation()</code> function.</p>
<div id="simple-annotation" class="section level2">
<h2><span class="header-section-number">3.1</span> Simple annotation</h2>
<p>A so-called <em>“simple annotation”</em> is the most used style of annotations which
is heatmap-like or grid-like graphics where colors are used to map to the
anntation values. To generate a simple annotation, you just simply put the
annotation vector in <code>HeatmapAnnotation()</code> with a specific name.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Or a discrete annotation:</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb172-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">bar =</span> <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-10-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>You can use any strings as annotation names except those pre-defined arguments
in <code>HeatmapAnnotation()</code>.</p>
<p>If colors are not specified, colors are randomly generated. To set the colors
for annotation, <code>col</code> needs to be set as a named list. For continuous values,
the color mapping should be a color mapping function generated by
<code>circlize::colorRamp2()</code>.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" data-line-number="1"><span class="kw">library</span>(circlize)</a>
<a class="sourceLine" id="cb173-2" data-line-number="2">col_fun =<span class="st"> </span><span class="kw">colorRamp2</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;red&quot;</span>))</a>
<a class="sourceLine" id="cb173-3" data-line-number="3">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">foo =</span> col_fun))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-12-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>And for discrete annotations, the color should be a named vector where names
correspond to the levels in the annotation.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">bar =</span> <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb174-2" data-line-number="2">    <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">bar =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;green&quot;</span>, <span class="st">&quot;c&quot;</span> =<span class="st"> &quot;blue&quot;</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-14-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>If you specify more than one vectors, there will be multiple annotations
(<code>foo</code> and <code>bar</code> in following example). Also you can see how <code>col</code> is set when
<code>foo</code> and <code>bar</code> are all put into a single <code>HeatmapAnnotation()</code>. Maybe now you
can understand the names in the color list is actually used to map to the
annotation names. Values in <code>col</code> will be used to construct legends for simple
annotations.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(</a>
<a class="sourceLine" id="cb175-2" data-line-number="2">    <span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, </a>
<a class="sourceLine" id="cb175-3" data-line-number="3">    <span class="dt">bar =</span> <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb175-4" data-line-number="4">    <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">foo =</span> col_fun,</a>
<a class="sourceLine" id="cb175-5" data-line-number="5">               <span class="dt">bar =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;green&quot;</span>, <span class="st">&quot;c&quot;</span> =<span class="st"> &quot;blue&quot;</span>)</a>
<a class="sourceLine" id="cb175-6" data-line-number="6">    )</a>
<a class="sourceLine" id="cb175-7" data-line-number="7">)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-16-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The color for <code>NA</code> value is controlled by <code>na_col</code> argument.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(</a>
<a class="sourceLine" id="cb176-2" data-line-number="2">    <span class="dt">foo =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="ot">NA</span>, <span class="dv">6</span><span class="op">:</span><span class="dv">10</span>), </a>
<a class="sourceLine" id="cb176-3" data-line-number="3">    <span class="dt">bar =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">9</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)),</a>
<a class="sourceLine" id="cb176-4" data-line-number="4">    <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">foo =</span> col_fun,</a>
<a class="sourceLine" id="cb176-5" data-line-number="5">               <span class="dt">bar =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;green&quot;</span>, <span class="st">&quot;c&quot;</span> =<span class="st"> &quot;blue&quot;</span>)</a>
<a class="sourceLine" id="cb176-6" data-line-number="6">    ),</a>
<a class="sourceLine" id="cb176-7" data-line-number="7">    <span class="dt">na_col =</span> <span class="st">&quot;black&quot;</span></a>
<a class="sourceLine" id="cb176-8" data-line-number="8">)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-18-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><code>gp</code> mainly controls the graphic parameters for the borders of the grids.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(</a>
<a class="sourceLine" id="cb177-2" data-line-number="2">    <span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, </a>
<a class="sourceLine" id="cb177-3" data-line-number="3">    <span class="dt">bar =</span> <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb177-4" data-line-number="4">    <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">foo =</span> col_fun,</a>
<a class="sourceLine" id="cb177-5" data-line-number="5">               <span class="dt">bar =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;green&quot;</span>, <span class="st">&quot;c&quot;</span> =<span class="st"> &quot;blue&quot;</span>)</a>
<a class="sourceLine" id="cb177-6" data-line-number="6">    ),</a>
<a class="sourceLine" id="cb177-7" data-line-number="7">    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;black&quot;</span>)</a>
<a class="sourceLine" id="cb177-8" data-line-number="8">)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-20-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The simple annotation can also be a matrix (numeric or character) that all the
columns in the matrix share a same color mapping schema. <strong>Note columns in the
matrix correspond to the rows in the column annotation.</strong> Also the column
names of the matrix are used as the annotation names.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">cbind</span>(<span class="dt">a =</span> <span class="kw">runif</span>(<span class="dv">10</span>), <span class="dt">b =</span> <span class="kw">runif</span>(<span class="dv">10</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-22-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>If the matrix has no column name, the name of the annotation is still used, but drawn
in the middle of the annotation.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb179-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">cbind</span>(<span class="kw">runif</span>(<span class="dv">10</span>), <span class="kw">runif</span>(<span class="dv">10</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-24-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>As simple annotations can be in different modes (e.g. numeric, or character),
they can be combined as a data frame and send to <code>df</code> argument. Imaging in your
project, you might already have an annotation table, you can directly set it by
<code>df</code>.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" data-line-number="1">anno_df =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb180-2" data-line-number="2">    <span class="dt">bar =</span> <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb180-3" data-line-number="3">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">df =</span> anno_df,</a>
<a class="sourceLine" id="cb180-4" data-line-number="4">    <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">foo =</span> col_fun,</a>
<a class="sourceLine" id="cb180-5" data-line-number="5">               <span class="dt">bar =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;green&quot;</span>, <span class="st">&quot;c&quot;</span> =<span class="st"> &quot;blue&quot;</span>)</a>
<a class="sourceLine" id="cb180-6" data-line-number="6">    )</a>
<a class="sourceLine" id="cb180-7" data-line-number="7">)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-26-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Single annotations and data frame can be mixed. In following example, colors
for <code>foo2</code> is not specified, random colors will be used.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb181-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">df =</span> anno_df,</a>
<a class="sourceLine" id="cb181-2" data-line-number="2">    <span class="dt">foo2 =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb181-3" data-line-number="3">    <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">foo =</span> col_fun,</a>
<a class="sourceLine" id="cb181-4" data-line-number="4">               <span class="dt">bar =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;green&quot;</span>, <span class="st">&quot;c&quot;</span> =<span class="st"> &quot;blue&quot;</span>)</a>
<a class="sourceLine" id="cb181-5" data-line-number="5">    )</a>
<a class="sourceLine" id="cb181-6" data-line-number="6">)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-28-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><code>border</code> controls the border of every single annotation.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(</a>
<a class="sourceLine" id="cb182-2" data-line-number="2">    <span class="dt">foo =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb182-3" data-line-number="3">    <span class="dt">bar =</span> <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb182-4" data-line-number="4">    <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">foo =</span> col_fun,</a>
<a class="sourceLine" id="cb182-5" data-line-number="5">               <span class="dt">bar =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;green&quot;</span>, <span class="st">&quot;c&quot;</span> =<span class="st"> &quot;blue&quot;</span>)</a>
<a class="sourceLine" id="cb182-6" data-line-number="6">    ),</a>
<a class="sourceLine" id="cb182-7" data-line-number="7">    <span class="dt">border =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb182-8" data-line-number="8">)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-30-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The height of the simple annotation is controlled by <code>simple_anno_size</code>
argument. Since all single annotations have same height, the value of
<code>simple_anno_size</code> is a single <code>unit</code> value. Note there are arguments like
<code>width</code>, <code>height</code>, <code>annotation_width</code> and <code>annotation_height</code>, but they are
used to adjust the width/height for the complete heamtap annotations (which
are always mix of several annotations). The adjustment of these four arguments
will be introduced in Section <a href="heatmap-annotations.html#multiple-annotations">3.18</a>.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb183-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(</a>
<a class="sourceLine" id="cb183-2" data-line-number="2">    <span class="dt">foo =</span> <span class="kw">cbind</span>(<span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">b =</span> <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb183-3" data-line-number="3">    <span class="dt">bar =</span> <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb183-4" data-line-number="4">    <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">foo =</span> col_fun,</a>
<a class="sourceLine" id="cb183-5" data-line-number="5">               <span class="dt">bar =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;green&quot;</span>, <span class="st">&quot;c&quot;</span> =<span class="st"> &quot;blue&quot;</span>)</a>
<a class="sourceLine" id="cb183-6" data-line-number="6">    ),</a>
<a class="sourceLine" id="cb183-7" data-line-number="7">    <span class="dt">simple_anno_size =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;cm&quot;</span>)</a>
<a class="sourceLine" id="cb183-8" data-line-number="8">)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-32-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>When you have multiple heatmaps and it is better to keep the size of simple
annotations on all heatmaps with the same size. <code>ht_opt$simple_anno_size</code> can
be set to control the simple annotation size globally (It will be introduced
in Section <a href="a-list-of-heatmaps.html#change-parameters-globally">4.13</a>).</p>
</div>
<div id="simple-annotation-as-an-annotation-function" class="section level2">
<h2><span class="header-section-number">3.2</span> Simple annotation as an annotation function</h2>
<p><code>HeatmapAnnotation()</code> supports <em>“complex annotation”</em> by setting the
annotation as a function. The annotation function defines how to draw the
graphics at a certain position corresponding to the column or row in the
heatmap. There are quite a lot of annotation functions predefined in
<strong>ComplexHeatmap</strong> package. In the end of this chapter, we will introduce how
to construct your own annotation function by the <code>AnnotationFunction</code> class.</p>
<p>For all the annotation functions in forms of <code>anno_*()</code>, if it is specified in
<code>HeatmapAnnotation()</code> or <code>rowAnnotation()</code>, you don’t need to do anything
explicitly on <code>anno_*()</code> to tell whether it should be drawn on rows or
columns. <code>anno_*()</code> automatically detects whether it is a row annotation
environment or a column annotation environment.</p>
<p>The simple annotation shown in previous section is internally constructed by
<code>anno_simple()</code> annotation function. Directly using <code>anno_simple()</code> will not
automatically generate legends for the final plot, but, it can provide more
flexibility for more annotation graphics (note In Chapter
<a href="legends.html#legends">5</a> we will show, although <code>anno_simple()</code> cannot automatically generate the
legends, the legends can be controlled and added to the final plot manually).</p>
<p>For an example in previous section:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" data-line-number="1"><span class="co"># code only for demonstration</span></a>
<a class="sourceLine" id="cb184-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a></code></pre></div>
<p>is actually identical to:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" data-line-number="1"><span class="co"># code only for demonstration</span></a>
<a class="sourceLine" id="cb185-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</a></code></pre></div>
<p><code>anno_simple()</code> makes heatmap-like annotations (or the simple annotations).
Basically if users only make heatmap-like annotations, they do not need to
directly use <code>anno_simple()</code>, but this function allows to add more symbols on
the annotation grids.</p>
<p><code>anno_simple()</code> allows to add “points” or single-letter symbols on top of the
annotation grids. <code>pch</code>, <code>pt_gp</code> and <code>pt_size</code> control the settings of the
points. The value of <code>pch</code> can be a vector with possible <code>NA</code> values.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">pch =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb186-2" data-line-number="2">    <span class="dt">pt_gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>), <span class="dt">pt_size =</span> <span class="kw">unit</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="st">&quot;mm&quot;</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-36-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Set <code>pch</code> as a vector:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">pch =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-38-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Set <code>pch</code> as a vector of letters:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, </a>
<a class="sourceLine" id="cb188-2" data-line-number="2">    <span class="dt">pch =</span> <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-40-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Set <code>pch</code> as a vector with <code>NA</code> values (nothing is drawn for <code>NA</code> pch values):</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="ot">NA</span>, <span class="dv">6</span><span class="op">:</span><span class="dv">8</span>, <span class="ot">NA</span>, <span class="dv">10</span>, <span class="dv">11</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-42-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><code>pch</code> also works if the value for <code>anno_simple()</code> is a matrix. The length of
<code>pch</code> should be as same as the number of matrix rows or columns or even the
length of the matrix (the length of the matrix is the length of all data
points in the matrix).</p>
<p>Length of <code>pch</code> corresponds to matrix columns:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), <span class="dt">pch =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-44-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Lenght of <code>pch</code> corresponds to matrix rows:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), <span class="dt">pch =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-46-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><code>pch</code> is a matrix:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" data-line-number="1">pch =<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">nc =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb192-2" data-line-number="2">pch[<span class="kw">sample</span>(<span class="kw">length</span>(pch), <span class="dv">10</span>)] =<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb192-3" data-line-number="3">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), <span class="dt">pch =</span> pch))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-48-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Till now, you might wonder how to set the legends of the symbols you’ve added
to the simple annotations. Here we will only show you a simple example and
this functionality will be discussed in Chapter <a href="legends.html#legends">5</a>. In following
example, we assume the simple annotations are kind of p-values and we add <code>*</code>
for p-values less than 0.01.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb193-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb193-2" data-line-number="2">pvalue =<span class="st"> </span><span class="dv">10</span><span class="op">^-</span><span class="kw">runif</span>(<span class="dv">10</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb193-3" data-line-number="3">is_sig =<span class="st"> </span>pvalue <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.01</span></a>
<a class="sourceLine" id="cb193-4" data-line-number="4">pch =<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;*&quot;</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb193-5" data-line-number="5">pch[<span class="op">!</span>is_sig] =<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb193-6" data-line-number="6"><span class="co"># color mapping for -log10(pvalue)</span></a>
<a class="sourceLine" id="cb193-7" data-line-number="7">pvalue_col_fun =<span class="st"> </span><span class="kw">colorRamp2</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="kw">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;red&quot;</span>)) </a>
<a class="sourceLine" id="cb193-8" data-line-number="8">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(</a>
<a class="sourceLine" id="cb193-9" data-line-number="9">    <span class="dt">pvalue =</span> <span class="kw">anno_simple</span>(<span class="op">-</span><span class="kw">log10</span>(pvalue), <span class="dt">col =</span> pvalue_col_fun, <span class="dt">pch =</span> pch),</a>
<a class="sourceLine" id="cb193-10" data-line-number="10">    <span class="dt">annotation_name_side =</span> <span class="st">&quot;left&quot;</span>)</a>
<a class="sourceLine" id="cb193-11" data-line-number="11">ht =<span class="st"> </span><span class="kw">Heatmap</span>(<span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dv">10</span>), <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>, <span class="dt">top_annotation =</span> ha)</a>
<a class="sourceLine" id="cb193-12" data-line-number="12"><span class="co"># now we generate two legends, one for the p-value</span></a>
<a class="sourceLine" id="cb193-13" data-line-number="13"><span class="co"># see how we define the legend for pvalue</span></a>
<a class="sourceLine" id="cb193-14" data-line-number="14">lgd_pvalue =<span class="st"> </span><span class="kw">Legend</span>(<span class="dt">title =</span> <span class="st">&quot;p-value&quot;</span>, <span class="dt">col =</span> pvalue_col_fun, <span class="dt">at =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), </a>
<a class="sourceLine" id="cb193-15" data-line-number="15">    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;0.1&quot;</span>, <span class="st">&quot;0.01&quot;</span>, <span class="st">&quot;0.001&quot;</span>))</a>
<a class="sourceLine" id="cb193-16" data-line-number="16"><span class="co"># and one for the significant p-values</span></a>
<a class="sourceLine" id="cb193-17" data-line-number="17">lgd_sig =<span class="st"> </span><span class="kw">Legend</span>(<span class="dt">pch =</span> <span class="st">&quot;*&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;points&quot;</span>, <span class="dt">labels =</span> <span class="st">&quot;&lt; 0.01&quot;</span>)</a>
<a class="sourceLine" id="cb193-18" data-line-number="18"><span class="co"># these two self-defined legends are added to the plot by `annotation_legend_list`</span></a>
<a class="sourceLine" id="cb193-19" data-line-number="19"><span class="kw">draw</span>(ht, <span class="dt">annotation_legend_list =</span> <span class="kw">list</span>(lgd_pvalue, lgd_sig))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-49-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>The height of the simple annotation can be controled by <code>height</code> argument or
<code>simple_anno_size</code> inside <code>anno_simple()</code>. <code>simple_anno_size</code> controls the
size for single-row annotation and <code>height</code>/<code>width</code> controls the total
height/width of the simple annotations. If <code>height</code>/<code>width</code> is set,
<code>simple_anno_size</code> is ignored.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;cm&quot;</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-51-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb195-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb195-2" data-line-number="2">    <span class="dt">simple_anno_size =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;cm&quot;</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-53-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><strong>For all the annotation functions we introduce later, the height or the width
for individual annotations should all be set inside the <code>anno_*()</code>
functions.</strong></p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" data-line-number="1"><span class="co"># code only for demonstration</span></a>
<a class="sourceLine" id="cb196-2" data-line-number="2">anno_<span class="op">*</span>(..., <span class="dt">width =</span> ...)</a>
<a class="sourceLine" id="cb196-3" data-line-number="3">anno_<span class="op">*</span>(..., <span class="dt">height =</span> ...)</a></code></pre></div>
<p>Again, the <code>width</code>, <code>height</code>, <code>annotation_width</code> and <code>annotation_height</code>
arguments in <code>HeatmapAnnotation()</code> are used to adjust the size of multiple
annotations.</p>
</div>
<div id="empty-annotation" class="section level2">
<h2><span class="header-section-number">3.3</span> Empty annotation</h2>
<p><code>anno_empty()</code> is a place holder where nothing is drawn. Later user-defined
graphics can be added by <code>decorate_annotation()</code> function.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_empty</span>(<span class="dt">border =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-56-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>In Chapter <a href="heatmap-decoration.html#heatmap-decoration">6</a>, we will introduce the use of the
decoration functions, but here we give a quick example. In gene expression
expression analysis, there are senarios that we split the heatmaps into
several groups and we want to highlight some key genes in each group. In this
case, we simply add the gene names on the right side of the heatmap without
aligning them to the their corresponding rows. (<code>anno_mark()</code> can align the
labels correclty to their corresponding rows, but in the example we show here,
it is not necessray).</p>
<p>In following example, since rows are split into four slices, the empty
annotation is also split into four slices. Basically what we do is in each
empty annotation slice, we add a colored segment and text.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" data-line-number="1">random_text =<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb198-2" data-line-number="2">    <span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>n, <span class="cf">function</span>(i) {</a>
<a class="sourceLine" id="cb198-3" data-line-number="3">        <span class="kw">paste0</span>(<span class="kw">sample</span>(letters, <span class="kw">sample</span>(<span class="dv">4</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">1</span>)), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb198-4" data-line-number="4">    })</a>
<a class="sourceLine" id="cb198-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb198-6" data-line-number="6">text_list =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb198-7" data-line-number="7">    <span class="dt">text1 =</span> <span class="kw">random_text</span>(<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb198-8" data-line-number="8">    <span class="dt">text2 =</span> <span class="kw">random_text</span>(<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb198-9" data-line-number="9">    <span class="dt">text3 =</span> <span class="kw">random_text</span>(<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb198-10" data-line-number="10">    <span class="dt">text4 =</span> <span class="kw">random_text</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb198-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb198-12" data-line-number="12"><span class="co"># note how we set the width of this empty annotation</span></a>
<a class="sourceLine" id="cb198-13" data-line-number="13">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_empty</span>(<span class="dt">border =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb198-14" data-line-number="14">    <span class="dt">width =</span> <span class="kw">max_text_width</span>(<span class="kw">unlist</span>(text_list)) <span class="op">+</span><span class="st"> </span><span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;mm&quot;</span>)))</a>
<a class="sourceLine" id="cb198-15" data-line-number="15"><span class="kw">Heatmap</span>(<span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">1000</span>), <span class="dt">nrow =</span> <span class="dv">100</span>), <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>, <span class="dt">row_km =</span> <span class="dv">4</span>, <span class="dt">right_annotation =</span> ha)</a>
<a class="sourceLine" id="cb198-16" data-line-number="16"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {</a>
<a class="sourceLine" id="cb198-17" data-line-number="17">    <span class="kw">decorate_annotation</span>(<span class="st">&quot;foo&quot;</span>, <span class="dt">slice =</span> i, {</a>
<a class="sourceLine" id="cb198-18" data-line-number="18">        <span class="kw">grid.rect</span>(<span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;mm&quot;</span>), <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> i, <span class="dt">col =</span> <span class="ot">NA</span>), <span class="dt">just =</span> <span class="st">&quot;left&quot;</span>)</a>
<a class="sourceLine" id="cb198-19" data-line-number="19">        <span class="kw">grid.text</span>(<span class="kw">paste</span>(text_list[[i]], <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>), <span class="dt">x =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;mm&quot;</span>), <span class="dt">just =</span> <span class="st">&quot;left&quot;</span>)</a>
<a class="sourceLine" id="cb198-20" data-line-number="20">    })</a>
<a class="sourceLine" id="cb198-21" data-line-number="21">}</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-57-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>A second use of the empty annotation is to add complex annotation graphics
where the empty annotation pretends to be a virtual plotting region. You can
construct an annotation function by <code>AnnotationFunction</code> class for complex
annotation graphics, which allows subsetting and splitting, but still, it can
be a secondary choice to directly draw inside the empty annotation, which is
easier and faster for implementing (but less flexible and does not allow
splitting).</p>
<p>In following we show how to add a “complex version” of points annotation. The
only thing that needs to be careful is the location on x-axis (y-axis if it is
a row annotation) should correspond to the column index after column
reordering.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb199-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_empty</span>(<span class="dt">border =</span> <span class="ot">TRUE</span>, <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">3</span>, <span class="st">&quot;cm&quot;</span>)))</a>
<a class="sourceLine" id="cb199-2" data-line-number="2">ht =<span class="st"> </span><span class="kw">Heatmap</span>(<span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dt">nrow =</span> <span class="dv">10</span>), <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>, <span class="dt">top_annotation =</span> ha)</a>
<a class="sourceLine" id="cb199-3" data-line-number="3">ht =<span class="st"> </span><span class="kw">draw</span>(ht)</a>
<a class="sourceLine" id="cb199-4" data-line-number="4">co =<span class="st"> </span><span class="kw">column_order</span>(ht)</a>
<a class="sourceLine" id="cb199-5" data-line-number="5">value =<span class="st"> </span><span class="kw">runif</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb199-6" data-line-number="6"><span class="kw">decorate_annotation</span>(<span class="st">&quot;foo&quot;</span>, {</a>
<a class="sourceLine" id="cb199-7" data-line-number="7">    <span class="co"># value on x-axis is always 1:ncol(mat)</span></a>
<a class="sourceLine" id="cb199-8" data-line-number="8">    x =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb199-9" data-line-number="9">    <span class="co"># while values on y-axis is the value after column reordering</span></a>
<a class="sourceLine" id="cb199-10" data-line-number="10">    value =<span class="st"> </span>value[co]</a>
<a class="sourceLine" id="cb199-11" data-line-number="11">    <span class="kw">pushViewport</span>(<span class="kw">viewport</span>(<span class="dt">xscale =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">10.5</span>), <span class="dt">yscale =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb199-12" data-line-number="12">    <span class="kw">grid.lines</span>(<span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">10.5</span>), <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">lty =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb199-13" data-line-number="13">        <span class="dt">default.units =</span> <span class="st">&quot;native&quot;</span>)</a>
<a class="sourceLine" id="cb199-14" data-line-number="14">    <span class="kw">grid.points</span>(x, value, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">size =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;mm&quot;</span>),</a>
<a class="sourceLine" id="cb199-15" data-line-number="15">        <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="kw">ifelse</span>(value <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>)), <span class="dt">default.units =</span> <span class="st">&quot;native&quot;</span>)</a>
<a class="sourceLine" id="cb199-16" data-line-number="16">    <span class="kw">grid.yaxis</span>(<span class="dt">at =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb199-17" data-line-number="17">    <span class="kw">popViewport</span>()</a>
<a class="sourceLine" id="cb199-18" data-line-number="18">})</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-58-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="block-annotation" class="section level2">
<h2><span class="header-section-number">3.4</span> Block annotation</h2>
<p>The block annotation is more like a color block which identifies groups when
the rows or columns of the heatmap are split.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" data-line-number="1"><span class="kw">Heatmap</span>(<span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dv">10</span>), <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>,</a>
<a class="sourceLine" id="cb200-2" data-line-number="2">    <span class="dt">top_annotation =</span> <span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_block</span>(<span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">4</span>))),</a>
<a class="sourceLine" id="cb200-3" data-line-number="3">    <span class="dt">column_km =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-59-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Labels can be added to each block.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb201-1" data-line-number="1"><span class="kw">Heatmap</span>(<span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dv">10</span>), </a>
<a class="sourceLine" id="cb201-2" data-line-number="2">    <span class="dt">top_annotation =</span> <span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_block</span>(<span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">4</span>),</a>
<a class="sourceLine" id="cb201-3" data-line-number="3">        <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;group1&quot;</span>, <span class="st">&quot;group2&quot;</span>, <span class="st">&quot;group3&quot;</span>), </a>
<a class="sourceLine" id="cb201-4" data-line-number="4">        <span class="dt">labels_gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">fontsize =</span> <span class="dv">10</span>))),</a>
<a class="sourceLine" id="cb201-5" data-line-number="5">    <span class="dt">column_km =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb201-6" data-line-number="6">    <span class="dt">left_annotation =</span> <span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_block</span>(<span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">4</span>),</a>
<a class="sourceLine" id="cb201-7" data-line-number="7">        <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;group1&quot;</span>, <span class="st">&quot;group2&quot;</span>, <span class="st">&quot;group3&quot;</span>), </a>
<a class="sourceLine" id="cb201-8" data-line-number="8">        <span class="dt">labels_gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">fontsize =</span> <span class="dv">10</span>))),</a>
<a class="sourceLine" id="cb201-9" data-line-number="9">    <span class="dt">row_km =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-60-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Note the length of <code>labels</code> or graphic parameters should have the same length
as the number of slices.</p>
</div>
<div id="image-annotation" class="section level2">
<h2><span class="header-section-number">3.5</span> Image annotation</h2>
<p>Images can be added as annotations. <code>anno_image()</code> supports image in <code>png</code>,
<code>svg</code>, <code>pdf</code>, <code>eps</code>, <code>jpeg/jpg</code>, <code>tiff</code> formats. How they are imported as
annotations are as follows:</p>
<ul>
<li><code>png</code>, <code>jpeg/jpg</code> and <code>tiff</code> images are imported by <code>png::readPNG()</code>,
<code>jpeg::readJPEG()</code> and <code>tiff::readTIFF()</code>, and drawn by
<code>grid::grid.raster()</code>.</li>
<li><code>svg</code> images are firstly reformatted by <code>rsvg::rsvg_svg()</code> and then imported
by <code>grImport2::readPicture()</code> and drawn by <code>grImport2::grid.picture()</code>.</li>
<li><code>pdf</code> and <code>eps</code> images are imported by <code>grImport::PostScriptTrace()</code> and
<code>grImport::readPicture()</code>, later drawn by <code>grImport::grid.picture()</code>.</li>
</ul>
<p>The free icons for following examples are from
<a href="https://github.com/Keyamoon/IcoMoon-Free" class="uri">https://github.com/Keyamoon/IcoMoon-Free</a>. A vector of image paths are set as
the first argument of <code>anno_image()</code>.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" data-line-number="1">image_png =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">dir</span>(<span class="st">&quot;IcoMoon-Free-master/PNG/64px&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>), <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb202-2" data-line-number="2">image_svg =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">dir</span>(<span class="st">&quot;IcoMoon-Free-master/SVG/&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>), <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb202-3" data-line-number="3">image_eps =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">dir</span>(<span class="st">&quot;IcoMoon-Free-master/EPS/&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>), <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb202-4" data-line-number="4">image_pdf =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">dir</span>(<span class="st">&quot;IcoMoon-Free-master/PDF/&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>), <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb202-5" data-line-number="5"></a>
<a class="sourceLine" id="cb202-6" data-line-number="6"><span class="co"># we only draw the image annotation for PNG images, while the others are the same</span></a>
<a class="sourceLine" id="cb202-7" data-line-number="7">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_image</span>(image_png))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-62-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Different image formats can be mixed in the input vector.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb203-1" data-line-number="1"><span class="co"># code only for demonstration</span></a>
<a class="sourceLine" id="cb203-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_image</span>(<span class="kw">c</span>(image_png[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], image_svg[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], </a>
<a class="sourceLine" id="cb203-3" data-line-number="3">    image_eps[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], image_pdf[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])))</a></code></pre></div>
<p>Border and background colors (if the images have transparent background) can
be set by <code>gp</code>.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_image</span>(image_png, </a>
<a class="sourceLine" id="cb204-2" data-line-number="2">    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-65-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><code>border</code> controls the border of the whole annotation.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb205-1" data-line-number="1"><span class="co"># code only for demonstration</span></a>
<a class="sourceLine" id="cb205-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_image</span>(image_png, <span class="dt">border =</span> <span class="st">&quot;red&quot;</span>))</a></code></pre></div>
<p>Padding or space around the images is set by <code>space</code>.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_image</span>(image_png, <span class="dt">space =</span> <span class="kw">unit</span>(<span class="dv">3</span>, <span class="st">&quot;mm&quot;</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-68-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>If only some of the images need to be drawn, the other elements in the <code>image</code>
vector can be set to <code>''</code> or <code>NA</code>.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb207-1" data-line-number="1">image_png[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>] =<span class="st"> &quot;&quot;</span></a>
<a class="sourceLine" id="cb207-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_image</span>(image_png))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-70-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="points-annotation" class="section level2">
<h2><span class="header-section-number">3.6</span> Points annotation</h2>
<p>Points annotation implemented as <code>anno_points()</code> shows distribution of a list
of data points. The data points object <code>x</code> can be a single vector or a matrix.
If it is a matrix, the graphic settings such as <code>pch</code>, <code>size</code> and <code>gp</code> can
correpspond to matrix columns. Note again, if <code>x</code> is a matrix, rows in <code>x</code>
correspond to columns in the heatmap matrix.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_points</span>(<span class="kw">runif</span>(<span class="dv">10</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-72-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb209-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_points</span>(<span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="dv">20</span>), <span class="dt">nc =</span> <span class="dv">2</span>), </a>
<a class="sourceLine" id="cb209-2" data-line-number="2">    <span class="dt">pch =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-74-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><code>ylim</code> controls the range on “y-axis” or the “data axis” (if it is a row
annotation, the data axis is horizontal), <code>extend</code> controls the extended space
on the data axis direction. <code>axis</code> controls whether to show the axis and
<code>axis_param</code> controls the settings for axis. The default settings for axis are:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" data-line-number="1"><span class="kw">default_axis_param</span>(<span class="st">&quot;column&quot;</span>)</a></code></pre></div>
<pre><code>## $at
## NULL
## 
## $labels
## NULL
## 
## $labels_rot
## [1] 0
## 
## $gp
## $fontsize
## [1] 8
## 
## 
## $side
## [1] &quot;left&quot;
## 
## $facing
## [1] &quot;outside&quot;
## 
## $direction
## [1] &quot;normal&quot;</code></pre>
<p>And you can overwrite some of them:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_points</span>(<span class="kw">runif</span>(<span class="dv">10</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb212-2" data-line-number="2">    <span class="dt">axis_param =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb212-3" data-line-number="3">        <span class="dt">side =</span> <span class="st">&quot;right&quot;</span>,</a>
<a class="sourceLine" id="cb212-4" data-line-number="4">        <span class="dt">at =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), </a>
<a class="sourceLine" id="cb212-5" data-line-number="5">        <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;zero&quot;</span>, <span class="st">&quot;half&quot;</span>, <span class="st">&quot;one&quot;</span>)</a>
<a class="sourceLine" id="cb212-6" data-line-number="6">    ))</a>
<a class="sourceLine" id="cb212-7" data-line-number="7">)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-77-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>One thing that might be useful is you can control the rotation of the axis
labels.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_points</span>(<span class="kw">runif</span>(<span class="dv">10</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb213-2" data-line-number="2">    <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;cm&quot;</span>),</a>
<a class="sourceLine" id="cb213-3" data-line-number="3">    <span class="dt">axis_param =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb213-4" data-line-number="4">        <span class="dt">side =</span> <span class="st">&quot;bottom&quot;</span>,</a>
<a class="sourceLine" id="cb213-5" data-line-number="5">        <span class="dt">at =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), </a>
<a class="sourceLine" id="cb213-6" data-line-number="6">        <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;zero&quot;</span>, <span class="st">&quot;half&quot;</span>, <span class="st">&quot;one&quot;</span>),</a>
<a class="sourceLine" id="cb213-7" data-line-number="7">        <span class="dt">labels_rot =</span> <span class="dv">45</span></a>
<a class="sourceLine" id="cb213-8" data-line-number="8">    ))</a>
<a class="sourceLine" id="cb213-9" data-line-number="9">)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-79-1.png" width="108.850393700787" style="display: block; margin: auto;" /></p>
<p>The configuration of axis is same for other annotation functions which have
axes.</p>
<p>The default size of the points annotation is 5mm. It can be controlled by
<code>height</code>/<code>width</code> argument in <code>anno_points()</code>.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb214-1" data-line-number="1"><span class="co"># code only for demonstration</span></a>
<a class="sourceLine" id="cb214-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_points</span>(<span class="kw">runif</span>(<span class="dv">10</span>), <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;cm&quot;</span>)))</a></code></pre></div>
</div>
<div id="lines-annotation" class="section level2">
<h2><span class="header-section-number">3.7</span> Lines annotation</h2>
<p><code>anno_lines()</code> connects the data points by a list of segments. Similar as
<code>anno_points()</code>, the data variable can be a numeric vector:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb215-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_lines</span>(<span class="kw">runif</span>(<span class="dv">10</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-82-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Or a matrix:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_lines</span>(<span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">5</span><span class="op">:</span><span class="dv">1</span>, <span class="dv">5</span><span class="op">:</span><span class="dv">1</span>)), </a>
<a class="sourceLine" id="cb216-2" data-line-number="2">    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>), <span class="dt">add_points =</span> <span class="ot">TRUE</span>, <span class="dt">pt_gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">6</span>), <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">16</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-84-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>As shown above, points can be added to the lines by setting <code>add_points = TRUE</code>.</p>
<p>Smoothed lines (by <code>loess()</code>) can be added instead of the original lines by
setting <code>smooth = TRUE</code>, but it should be used with caution because the order of
columns in the heatmap is used as “x-value” for the fitting and only if you think
the fitting against the reordered order makes sense.</p>
<p>Smoothing also works when the input data variable is a matrix that the smoothing
is performed for each column separately.</p>
<p>If <code>smooth</code> is <code>TRUE</code>, <code>add_points</code> is set to <code>TRUE</code> by default.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb217-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_lines</span>(<span class="kw">runif</span>(<span class="dv">10</span>), <span class="dt">smooth =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-86-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The default size of the lines annotation is 5mm. It can be controlled by
<code>height</code>/<code>width</code> argument in <code>anno_lines()</code>.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" data-line-number="1"><span class="co"># code only for demonstration</span></a>
<a class="sourceLine" id="cb218-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_lines</span>(<span class="kw">runif</span>(<span class="dv">10</span>), <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;cm&quot;</span>)))</a></code></pre></div>
</div>
<div id="barplot_annotation" class="section level2">
<h2><span class="header-section-number">3.8</span> Barplot annotation</h2>
<p>The data points can be represented as barplots. Some of the arguments in
<code>anno_barplot()</code> such as <code>ylim</code>, <code>axis</code>, <code>axis_param</code> are the same as
<code>anno_points()</code>.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb219-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_barplot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-89-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The width of bars is controlled by <code>bar_width</code>. It is a relative value to the
width of the cell in the heatmap.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_barplot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">bar_width =</span> <span class="dv">1</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-91-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Graphic parameters are controlled by <code>gp</code>.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_barplot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-93-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>You can choose the baseline of bars by <code>baseline</code>.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_barplot</span>(<span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">baseline =</span> <span class="st">&quot;min&quot;</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-95-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_barplot</span>(<span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">baseline =</span> <span class="dv">0</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-97-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>If the input value is a matrix, it will be stacked barplots.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_barplot</span>(<span class="kw">matrix</span>(<span class="dt">nc =</span> <span class="dv">2</span>, <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>))))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-99-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>And length of parameters in <code>gp</code> can be the number of the columns in the matrix:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb225-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_barplot</span>(<span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb225-2" data-line-number="2">    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">col =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-101-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The default size of the barplot annotation is 5mm. It can be controlled by
<code>height</code>/<code>width</code> argument in <code>anno_barplot()</code>.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" data-line-number="1"><span class="co"># code only for demonstration</span></a>
<a class="sourceLine" id="cb226-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_barplot</span>(<span class="kw">runif</span>(<span class="dv">10</span>), <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;cm&quot;</span>)))</a></code></pre></div>
<p>Following example shows a barplot annotation which visualizes a proportion
matrix (for which row sums are 1).</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb227-1" data-line-number="1">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="dv">4</span><span class="op">*</span><span class="dv">10</span>), <span class="dt">nc =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb227-2" data-line-number="2">m =<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(m, <span class="dv">1</span>, <span class="cf">function</span>(x) x<span class="op">/</span><span class="kw">sum</span>(x)))</a>
<a class="sourceLine" id="cb227-3" data-line-number="3">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_barplot</span>(m, <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">5</span>), </a>
<a class="sourceLine" id="cb227-4" data-line-number="4">    <span class="dt">bar_width =</span> <span class="dv">1</span>, <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">6</span>, <span class="st">&quot;cm&quot;</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-104-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The direction of the axis can be reversed which is useful when the annotation
is put on the left of the heatmap.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" data-line-number="1">ha_list =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">axis_reverse =</span> <span class="kw">anno_barplot</span>(m, <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">5</span>), </a>
<a class="sourceLine" id="cb228-2" data-line-number="2">    <span class="dt">axis_param =</span> <span class="kw">list</span>(<span class="dt">direction =</span> <span class="st">&quot;reverse&quot;</span>), </a>
<a class="sourceLine" id="cb228-3" data-line-number="3">    <span class="dt">bar_width =</span> <span class="dv">1</span>, <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;cm&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb228-4" data-line-number="4"><span class="kw">rowAnnotation</span>(<span class="dt">axis_normal =</span> <span class="kw">anno_barplot</span>(m, <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">5</span>), </a>
<a class="sourceLine" id="cb228-5" data-line-number="5">    <span class="dt">bar_width =</span> <span class="dv">1</span>, <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;cm&quot;</span>)))</a>
<a class="sourceLine" id="cb228-6" data-line-number="6"><span class="kw">draw</span>(ha_list, <span class="dt">ht_gap =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;mm&quot;</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-105-1.png" width="432" style="display: block; margin: auto;" /></p>
<p><code>direction = &quot;reverse&quot;</code> also works for other annotation functions which have
axes, but it is more commonly used for barplot annotations.</p>
</div>
<div id="box-annotation" class="section level2">
<h2><span class="header-section-number">3.9</span> Boxplot annotation</h2>
<p>Boxplot annotation as well as the annotation functions which are introduced
later are more suitable for small matrice. I don’t think you want to put
boxplots as column annotation for a matrix with 100 columns.</p>
<p>For <code>anno_boxplot()</code>, the input data variable should be a matrix or a list. If
<code>x</code> is a matrix and if it is a column annotation, statistics for boxplots are
calculated by columns, and if it is a row annotation, the calculation is done
by rows.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">12345</span>)</a>
<a class="sourceLine" id="cb229-2" data-line-number="2">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb229-3" data-line-number="3">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_boxplot</span>(m, <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;cm&quot;</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-107-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Graphic parameters are controlled by <code>gp</code>.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_boxplot</span>(m, <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;cm&quot;</span>), </a>
<a class="sourceLine" id="cb230-2" data-line-number="2">    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-109-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Width of the boxes are controlled by <code>box_width</code>. <code>outline</code> controls whether to
show outlier points.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_boxplot</span>(m, <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;cm&quot;</span>), </a>
<a class="sourceLine" id="cb231-2" data-line-number="2">    <span class="dt">box_width =</span> <span class="fl">0.9</span>, <span class="dt">outline =</span> <span class="ot">FALSE</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-111-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><code>anno_boxplot()</code> only draws one boxplot for one single row. Section
<a href="more-examples.html#add-multiple-boxplots-for-single-row">9.6</a> demonstrates how to define an annotation function which
draws multiple boxplots for a single row, and Section <a href="heatmap-annotations.html#zoom-annotation">3.17</a>
demonstrates how to draw one single boxplot for a group of rows.</p>
</div>
<div id="histogram-annotation" class="section level2">
<h2><span class="header-section-number">3.10</span> Histogram annotation</h2>
<p>Annotations as histograms are more suitable to put as row annotations. The
setting for the data variable is the same as <code>anno_boxplot()</code> which can be a
matrix or a list.</p>
<p>Similar as <code>anno_boxplot()</code>, the input data variable should be a matrix or a list. If
<code>x</code> is a matrix and if it is a column annotation, histograms are
calculated by columns, and if it is a row annotation, histograms are calculated
by rows.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" data-line-number="1">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">1000</span>), <span class="dt">nc =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb232-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_histogram</span>(m)) <span class="co"># apply `m` on rows</span></a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-113-1.png" width="166.299212598425" style="display: block; margin: auto;" /></p>
<p>Number of breaks for histograms is controlled by <code>n_breaks</code>.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_histogram</span>(m, <span class="dt">n_breaks =</span> <span class="dv">20</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-115-1.png" width="166.299212598425" style="display: block; margin: auto;" /></p>
<p>Colors are controlled by <code>gp</code>.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_histogram</span>(m, <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-117-1.png" width="166.299212598425" style="display: block; margin: auto;" /></p>
</div>
<div id="density-annotation" class="section level2">
<h2><span class="header-section-number">3.11</span> Density annotation</h2>
<p>Similar as histogram annotations, <code>anno_density()</code> shows the distribution
as a fitted curve.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_density</span>(m))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-119-1.png" width="166.299212598425" style="display: block; margin: auto;" /></p>
<p>The height of the density peaks can be controlled to make the distribution
look like a <a href="http://blog.revolutionanalytics.com/2017/07/joyplots.html">“joyplot”</a>.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_density</span>(m, <span class="dt">joyplot_scale =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb236-2" data-line-number="2">    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="st">&quot;#CCCCCC80&quot;</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-121-1.png" width="166.299212598425" style="display: block; margin: auto;" /></p>
<p>Or visualize the distribution as violin plot.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb237-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_density</span>(m, <span class="dt">type =</span> <span class="st">&quot;violin&quot;</span>, </a>
<a class="sourceLine" id="cb237-2" data-line-number="2">    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-123-1.png" width="166.299212598425" style="display: block; margin: auto;" /></p>
<p>When there are too many rows in the input variable, the space for normal
density peaks might be too small. In this case, we can visualize the
distribution by heatmaps.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" data-line-number="1">m2 =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">50</span><span class="op">*</span><span class="dv">10</span>), <span class="dt">nrow =</span> <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb238-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_density</span>(m2, <span class="dt">type =</span> <span class="st">&quot;heatmap&quot;</span>, <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">6</span>, <span class="st">&quot;cm&quot;</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-125-1.png" width="241.889763779528" style="display: block; margin: auto;" /></p>
<p>THe color schema for heatmap distribution is controlled by <code>heatmap_colors</code>.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_density</span>(m2, <span class="dt">type =</span> <span class="st">&quot;heatmap&quot;</span>, <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">6</span>, <span class="st">&quot;cm&quot;</span>), </a>
<a class="sourceLine" id="cb239-2" data-line-number="2">    <span class="dt">heatmap_colors =</span> <span class="kw">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;orange&quot;</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-127-1.png" width="241.889763779528" style="display: block; margin: auto;" /></p>
<p>In <strong>ComplexHeatmap</strong> package, there is a <code>densityHeatmap()</code> function which
visualizes distribution as a heatmap. It will be introduced in Section
<a href="other-high-level-plots.html#density-heatmap">10.1</a>.</p>
</div>
<div id="joyplot-annotation" class="section level2">
<h2><span class="header-section-number">3.12</span> Joyplot annotation</h2>
<p><code>anno_joyplot()</code> is specific for so-called joyplot (<a href="http://blog.revolutionanalytics.com/2017/07/joyplots.html" class="uri">http://blog.revolutionanalytics.com/2017/07/joyplots.html</a>).
The input data should be a matrix or a list.</p>
<p>Note <code>anno_joyplot()</code> is always applied to columns if the input is a matrix.
Because joyplot visualizes parallel distributions and the matrix is not a
necessary format while a list is already enough for it, if you are not sure
about how to set as a matrix, just convert it to a list for using it.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb240-1" data-line-number="1">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">1000</span>), <span class="dt">nc =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb240-2" data-line-number="2">lt =<span class="st"> </span><span class="kw">apply</span>(m, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw">data.frame</span>(<span class="kw">density</span>(x)[<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)]))</a>
<a class="sourceLine" id="cb240-3" data-line-number="3">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_joyplot</span>(lt, <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;cm&quot;</span>), </a>
<a class="sourceLine" id="cb240-4" data-line-number="4">    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>), <span class="dt">transparency =</span> <span class="fl">0.75</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-129-1.png" width="166.299212598425" style="display: block; margin: auto;" /></p>
<p>Or only show the lines (<code>scale</code> argument controls the relative height of the
curves).</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb241-1" data-line-number="1">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">5000</span>), <span class="dt">nc =</span> <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb241-2" data-line-number="2">lt =<span class="st"> </span><span class="kw">apply</span>(m, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw">data.frame</span>(<span class="kw">density</span>(x)[<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)]))</a>
<a class="sourceLine" id="cb241-3" data-line-number="3">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_joyplot</span>(lt, <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;cm&quot;</span>), <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="ot">NA</span>), </a>
<a class="sourceLine" id="cb241-4" data-line-number="4">    <span class="dt">scale =</span> <span class="dv">4</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-131-1.png" width="166.299212598425" style="display: block; margin: auto;" /></p>
<p>The format of the input variable is special. It can be one of the following
two:</p>
<ol style="list-style-type: decimal">
<li>a matrix (remember <code>anno_joyplot()</code> is always applied to columns of the
matrix) where x coordinate corresponds to <code>1:nrow(matrix)</code> and each column
in the matrix corresponds to one distribution in the joyplot.</li>
<li>a list of data frames where each data frame has two columns which
correspond to x coordinate and y coordinate.</li>
</ol>
</div>
<div id="horizon-chart-annotation" class="section level2">
<h2><span class="header-section-number">3.13</span> Horizon chart annotation</h2>
<p><a href="https://flowingdata.com/2015/07/02/changing-price-of-food-items-and-horizon-graphs/">Horizon
chart</a>
as annotation can only be added as row annotation. The format of the input
variable for <code>anno_horizon()</code> is the same as <code>anno_joyplot()</code> which is
introduced in previous section.</p>
<p>The default style of horizon chart annotation is:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" data-line-number="1">lt =<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="cf">function</span>(x) <span class="kw">cumprod</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">runif</span>(<span class="dv">1000</span>, <span class="op">-</span>x<span class="op">/</span><span class="dv">100</span>, x<span class="op">/</span><span class="dv">100</span>)) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb242-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_horizon</span>(lt))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-133-1.png" width="166.299212598425" style="display: block; margin: auto;" /></p>
<p>Values in each track are normalized by <code>x/max(abs(x))</code>.</p>
<p>Colors for positive values and negative values are controlled by <code>pos_fill</code>
and <code>neg_fill</code> in <code>gpar()</code>.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb243-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_horizon</span>(lt, </a>
<a class="sourceLine" id="cb243-2" data-line-number="2">    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">pos_fill =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">neg_fill =</span> <span class="st">&quot;darkgreen&quot;</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-135-1.png" width="166.299212598425" style="display: block; margin: auto;" /></p>
<p><code>pos_fill</code> and <code>neg_fill</code> can be assigned as a vector.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_horizon</span>(lt, </a>
<a class="sourceLine" id="cb244-2" data-line-number="2">    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">pos_fill =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="dt">each =</span> <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb244-3" data-line-number="3">              <span class="dt">neg_fill =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;darkgreen&quot;</span>, <span class="st">&quot;blue&quot;</span>), <span class="dt">each =</span> <span class="dv">10</span>))))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-137-1.png" width="166.299212598425" style="display: block; margin: auto;" /></p>
<p>Whether the peaks for negative values start from the bottom or from the top.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb245-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_horizon</span>(lt, <span class="dt">negative_from_top =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-139-1.png" width="166.299212598425" style="display: block; margin: auto;" /></p>
<p>The space between every two neighbouring charts.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_horizon</span>(lt, <span class="dt">gap =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;mm&quot;</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-141-1.png" width="166.299212598425" style="display: block; margin: auto;" /></p>
</div>
<div id="text-annotation" class="section level2">
<h2><span class="header-section-number">3.14</span> Text annotation</h2>
<p>Text can be used as annotations by <code>anno_text()</code>. Graphic parameters are controlled
by <code>gp</code>.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb247-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_text</span>(month.name, <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fontsize =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span><span class="op">+</span><span class="dv">4</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-143-1.png" width="113.507443569554" style="display: block; margin: auto;" /></p>
<p>Locationsn are controlled by <code>location</code> and <code>just</code>. Rotation is controlled by <code>rot</code>.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_text</span>(month.name, <span class="dt">location =</span> <span class="dv">1</span>, <span class="dt">rot =</span> <span class="dv">30</span>, </a>
<a class="sourceLine" id="cb248-2" data-line-number="2">    <span class="dt">just =</span> <span class="st">&quot;right&quot;</span>, <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fontsize =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span><span class="op">+</span><span class="dv">4</span>)))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-145-1.png" width="102.719105697635" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb249-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_text</span>(month.name, <span class="dt">location =</span> <span class="fl">0.5</span>, <span class="dt">just =</span> <span class="st">&quot;center&quot;</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-147-1.png" width="93.3741102362204" style="display: block; margin: auto;" /></p>
<p><code>location</code> and <code>just</code> are automatically calculated according the the position
of the annotations put to the heatmap (e.g. text are aligned to the left if it
is a right annotation to the heatmap and are aligned to the right it it is a
left annotation).</p>
<p>The width/height are automatically calculated based on all the text. Normally
you don’t need to manually set the width/height of it.</p>
<p>Background colors can be set by <code>gp</code>. Here <code>fill</code> controls the filled
background color, <code>col</code> controls the color of text and the non-standard
<code>border</code> controls the background border color.</p>
<p>You can see we explicitly set <code>width</code> as 1.2 times the width of the longest
text.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_text</span>(month.name, <span class="dt">location =</span> <span class="fl">0.5</span>, <span class="dt">just =</span> <span class="st">&quot;center&quot;</span>,</a>
<a class="sourceLine" id="cb250-2" data-line-number="2">    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="kw">rep</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">each =</span> <span class="dv">4</span>), <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>),</a>
<a class="sourceLine" id="cb250-3" data-line-number="3">    <span class="dt">width =</span> <span class="kw">max_text_width</span>(month.name)<span class="op">*</span><span class="fl">1.2</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-149-1.png" width="109.02531023622" style="display: block; margin: auto;" /></p>
</div>
<div id="mark-annotation" class="section level2">
<h2><span class="header-section-number">3.15</span> Mark annotation</h2>
<p>Sometimes there are many rows or columns in the heatmap and we want to mark
some of them. <code>anno_mark()</code> is used to mark subset of rows or columns and
connect to labels with lines.</p>
<p><code>anno_mark()</code> at least needs two arguments where <code>at</code> are the indices to the
original matrix and <code>labels</code> are the corresponding text.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" data-line-number="1">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">1000</span>), <span class="dt">nrow =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb251-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_mark</span>(<span class="dt">at =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">20</span>, <span class="dv">60</span>, <span class="dv">97</span><span class="op">:</span><span class="dv">100</span>), <span class="dt">labels =</span> month.name[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]))</a>
<a class="sourceLine" id="cb251-3" data-line-number="3"><span class="kw">Heatmap</span>(m, <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>, <span class="dt">cluster_rows =</span> <span class="ot">FALSE</span>, <span class="dt">right_annotation =</span> ha)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-150-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="summary-annotation" class="section level2">
<h2><span class="header-section-number">3.16</span> Summary annotation</h2>
<p>There is one special annotation <code>anno_summary()</code> which only works with
one-column heatmap or one-row heatmap (we can say the heatmap only contains a
vector). It shows summary statistics for the vector in the heatmap. If the
corresponding vector is discrete, the summary annotation is presented as
barplots and if the vector is continuous, the summary annotation is boxplot.
<code>anno_summary()</code> is always used when the heatmap is split so that statistics
can be compared between heatmap slices.</p>
<p>The first example shows the summary annotation for discrete heatmap. The
barplot shows the proportion of each level in each slice. The absolute values
can already be seen by the height of the heatmap slice.</p>
<p>The color schema for the barplots is automatically extracted from the heatmap.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb252-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">summary =</span> <span class="kw">anno_summary</span>(<span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;cm&quot;</span>)))</a>
<a class="sourceLine" id="cb252-2" data-line-number="2">v =<span class="st"> </span><span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dv">50</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb252-3" data-line-number="3">split =<span class="st"> </span><span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dv">50</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb252-4" data-line-number="4"></a>
<a class="sourceLine" id="cb252-5" data-line-number="5"><span class="kw">Heatmap</span>(v, <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;blue&quot;</span>),</a>
<a class="sourceLine" id="cb252-6" data-line-number="6">    <span class="dt">top_annotation =</span> ha, <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;cm&quot;</span>), <span class="dt">row_split =</span> split)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-151-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>The second example shows the summary annotation for continuous heatmap. The
graphic parameters should be manually set by <code>gp</code>. The legend of the boxplot
can be created and added as introduced in Section <a href="legends.html#discrete-legends">5.2</a>,
last second paragraph.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">summary =</span> <span class="kw">anno_summary</span>(<span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>), </a>
<a class="sourceLine" id="cb253-2" data-line-number="2">    <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;cm&quot;</span>)))</a>
<a class="sourceLine" id="cb253-3" data-line-number="3">v =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">50</span>)</a>
<a class="sourceLine" id="cb253-4" data-line-number="4"><span class="kw">Heatmap</span>(v, <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>, <span class="dt">top_annotation =</span> ha, <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;cm&quot;</span>), </a>
<a class="sourceLine" id="cb253-5" data-line-number="5">    <span class="dt">row_split =</span> split)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-152-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Normally we don’t draw this one-column heatmap along. It is always combined
with other “main heatmaps”. E.g. A gene expression matrix with a one-column
heatmap which shows whether the gene is a protein coding gene or a linc-RNA
gene.</p>
<p>In following, we show a simple example of a “main heatmap” with two one-column
heatmaps. The functionality of heatmap concatenation will be introduced in
Chapter <a href="a-list-of-heatmaps.html#a-list-of-heatmaps">4</a>.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb254-1" data-line-number="1">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">50</span><span class="op">*</span><span class="dv">10</span>), <span class="dt">nrow =</span> <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb254-2" data-line-number="2">ht_list =<span class="st"> </span><span class="kw">Heatmap</span>(m, <span class="dt">name =</span> <span class="st">&quot;main_matrix&quot;</span>)</a>
<a class="sourceLine" id="cb254-3" data-line-number="3"></a>
<a class="sourceLine" id="cb254-4" data-line-number="4">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">summary =</span> <span class="kw">anno_summary</span>(<span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">3</span>, <span class="st">&quot;cm&quot;</span>)))</a>
<a class="sourceLine" id="cb254-5" data-line-number="5">v =<span class="st"> </span><span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dv">50</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb254-6" data-line-number="6">ht_list =<span class="st"> </span>ht_list <span class="op">+</span><span class="st"> </span><span class="kw">Heatmap</span>(v, <span class="dt">name =</span> <span class="st">&quot;mat1&quot;</span>, <span class="dt">top_annotation =</span> ha, <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;cm&quot;</span>))</a>
<a class="sourceLine" id="cb254-7" data-line-number="7"></a>
<a class="sourceLine" id="cb254-8" data-line-number="8">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">summary =</span> <span class="kw">anno_summary</span>(<span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>), </a>
<a class="sourceLine" id="cb254-9" data-line-number="9">    <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">3</span>, <span class="st">&quot;cm&quot;</span>)))</a>
<a class="sourceLine" id="cb254-10" data-line-number="10">v =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">50</span>)</a>
<a class="sourceLine" id="cb254-11" data-line-number="11">ht_list =<span class="st"> </span>ht_list <span class="op">+</span><span class="st"> </span><span class="kw">Heatmap</span>(v, <span class="dt">name =</span> <span class="st">&quot;mat2&quot;</span>, <span class="dt">top_annotation =</span> ha, <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;cm&quot;</span>))</a>
<a class="sourceLine" id="cb254-12" data-line-number="12"></a>
<a class="sourceLine" id="cb254-13" data-line-number="13">split =<span class="st"> </span><span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dv">50</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb254-14" data-line-number="14">lgd_boxplot =<span class="st"> </span><span class="kw">Legend</span>(<span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;group a&quot;</span>, <span class="st">&quot;group b&quot;</span>), <span class="dt">title =</span> <span class="st">&quot;group&quot;</span>,</a>
<a class="sourceLine" id="cb254-15" data-line-number="15">    <span class="dt">legend_gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>)))</a>
<a class="sourceLine" id="cb254-16" data-line-number="16"><span class="kw">draw</span>(ht_list, <span class="dt">row_split =</span> split, <span class="dt">ht_gap =</span> <span class="kw">unit</span>(<span class="dv">5</span>, <span class="st">&quot;mm&quot;</span>), </a>
<a class="sourceLine" id="cb254-17" data-line-number="17">    <span class="dt">heatmap_legend_list =</span> <span class="kw">list</span>(lgd_boxplot))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-153-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="zoom-annotation" class="section level2">
<h2><span class="header-section-number">3.17</span> Zoom/link annotation</h2>
<p>It is very common scenario that we want to annotate subsets of rows/columns in
the heatmap. <code>anno_zoom()</code> helps to create plotting regions that correspond to
the original subsets of rows/columns in the heatmap. Since the height/width
are usually different from that from the orignal subsets in the heatmap, these
plotting regions created by <code>anno_zoom()</code> can be thought as “zoomings” of the
original heatmap.</p>
<p>Let’s see following example where we make boxplot for each row group.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb255-2" data-line-number="2">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">100</span><span class="op">*</span><span class="dv">10</span>), <span class="dt">nrow =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb255-3" data-line-number="3">subgroup =<span class="st"> </span><span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">100</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb255-4" data-line-number="4">rg =<span class="st"> </span><span class="kw">range</span>(m)</a>
<a class="sourceLine" id="cb255-5" data-line-number="5">panel_fun =<span class="st"> </span><span class="cf">function</span>(index, nm) {</a>
<a class="sourceLine" id="cb255-6" data-line-number="6">    <span class="kw">pushViewport</span>(<span class="kw">viewport</span>(<span class="dt">xscale =</span> rg, <span class="dt">yscale =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb255-7" data-line-number="7">    <span class="kw">grid.rect</span>()</a>
<a class="sourceLine" id="cb255-8" data-line-number="8">    <span class="kw">grid.xaxis</span>(<span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fontsize =</span> <span class="dv">8</span>))</a>
<a class="sourceLine" id="cb255-9" data-line-number="9">    <span class="kw">grid.boxplot</span>(m[index, ], <span class="dt">pos =</span> <span class="dv">1</span>, <span class="dt">direction =</span> <span class="st">&quot;horizontal&quot;</span>)</a>
<a class="sourceLine" id="cb255-10" data-line-number="10">    <span class="kw">popViewport</span>()</a>
<a class="sourceLine" id="cb255-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb255-12" data-line-number="12">anno =<span class="st"> </span><span class="kw">anno_zoom</span>(<span class="dt">align_to =</span> subgroup, <span class="dt">which =</span> <span class="st">&quot;row&quot;</span>, <span class="dt">panel_fun =</span> panel_fun, </a>
<a class="sourceLine" id="cb255-13" data-line-number="13">    <span class="dt">size =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;cm&quot;</span>), <span class="dt">gap =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;cm&quot;</span>), <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;cm&quot;</span>))</a>
<a class="sourceLine" id="cb255-14" data-line-number="14"><span class="kw">Heatmap</span>(m, <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>, <span class="dt">right_annotation =</span> <span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> anno), <span class="dt">row_split =</span> subgroup)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-154-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>The important arguments for <code>anno_zoom()</code> are:</p>
<ol style="list-style-type: decimal">
<li><code>align_to</code>: It defines how the plotting regions (or the boxes) correspond
to the rows or the columns in the heatmap. If the value is a list of
indices, each box corresponds to the rows or columns with indices in one
vector in the list. If the value is a categorical variable (e.g. a factor
or a character vector) that has the same length as the rows or columns in
the heatmap, each box corresponds to the rows/columns in each level in the
categorical variable.</li>
<li><code>panel_fun</code>: A self-defined function that defines how to draw graphics in
the box. The function must have a <code>index</code> argument which is the indices for
the rows/columns that the box corresponds to. It can have a second argument
<code>nm</code> which is the “name” of the selected part in the heatmap. The
corresponding value for <code>nm</code> comes from <code>align_to</code> if it is specified as a
categorical variable or a list with names.</li>
<li><code>size</code>: The size of boxes. It can be pure numeric that they are treated as
relative fractions of the total height/width of the heatmap. The value of
<code>size</code> can also be absolute units.</li>
<li><code>gap</code>: Gaps between boxes. It should be a <code>unit</code> object.</li>
</ol>
<p><code>anno_zoom()</code> also works for column annotations.</p>
<p>In previous example, box plots in the “zoom annotation” use the same data as in the
heatmap (they share using the same values in the matrix). In some other cases, the annotations
do not have very strong relations to the matrix, except the information of which
rows from the matrix. In this case, the functionality is more proper
to be understanded as to provide linking between subsets of rows and
a list of graphic regions. Thus, there is an <code>anno_link()</code> function which is basically the same as <code>anno_zoom()</code>.
The two functions are exactly the same, just with different names, depends
how you understand. An example of using <code>anno_link()</code> is to correspond a list of text to a
subset of rows, see examples from <a href="https://github.com/jokergoo/simplifyGO" class="uri">https://github.com/jokergoo/simplifyGO</a>.</p>
<p><img src='https://user-images.githubusercontent.com/449218/79051702-027a4d00-7c32-11ea-887e-ed3e171a03a0.png'><br></p>
</div>
<div id="multiple-annotations" class="section level2">
<h2><span class="header-section-number">3.18</span> Multiple annotations</h2>
<p>As mentioned before, to put multiple annotations in <code>HeatmapAnnotation()</code>,
they just need to be specified as name-value pairs. In <code>HeatmapAnnotation()</code>,
there are some arguments which controls multiple annotations. For these
arguments, they are specified as a vector which has same length as number of
the annotations, or a named vector with subset of the annotations.</p>
<p>The simple annotations which are specified as vectors, matrices and data
frames will automatically have legends on the heatmap. <code>show_legend</code> controls
whether to draw the legends for them. Note here if <code>show_legend</code> is a vector,
the value of <code>show_legend</code> should be in one of the following formats:</p>
<ul>
<li>A logical vector with the same length as the number of simple annotations.</li>
<li>A logical vector with the same length as the number of totla annotations. The
values for complex annotations are ignored.</li>
<li>A named vector to control subset of the simple annotations.</li>
</ul>
<p>For customization on the annotation legends, please refer to Section <a href="legends.html#heatmap-and-annotation-legends">5.4</a>.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb256-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, </a>
<a class="sourceLine" id="cb256-2" data-line-number="2">    <span class="dt">bar =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb256-3" data-line-number="3">    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb256-4" data-line-number="4">    <span class="dt">show_legend =</span> <span class="kw">c</span>(<span class="st">&quot;bar&quot;</span> =<span class="st"> </span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb256-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb256-6" data-line-number="6"><span class="kw">Heatmap</span>(<span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dv">10</span>), <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>, <span class="dt">top_annotation =</span> ha)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-155-1.png" width="480" style="display: block; margin: auto;" /></p>
<p><code>gp</code> controls graphic parameters (except <code>fill</code>) for the simple annotatios,
such as the border of annotation grids.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, </a>
<a class="sourceLine" id="cb257-2" data-line-number="2">    <span class="dt">bar =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb257-3" data-line-number="3">    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb257-4" data-line-number="4">    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb257-5" data-line-number="5">)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-157-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><code>border</code> controls the border of every single annotations.
<code>show_annotation_name</code> controls whether show annotation names. As mentioned,
the value can be a single value, a vector or a named vector.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb258-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, </a>
<a class="sourceLine" id="cb258-2" data-line-number="2">    <span class="dt">bar =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb258-3" data-line-number="3">    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb258-4" data-line-number="4">    <span class="dt">show_annotation_name =</span> <span class="kw">c</span>(<span class="dt">bar =</span> <span class="ot">FALSE</span>), <span class="co"># only turn off `bar`</span></a>
<a class="sourceLine" id="cb258-5" data-line-number="5">    <span class="dt">border =</span> <span class="kw">c</span>(<span class="dt">foo =</span> <span class="ot">TRUE</span>) <span class="co"># turn on foo</span></a>
<a class="sourceLine" id="cb258-6" data-line-number="6">)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-159-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><code>annotation_name_gp</code>, <code>annotation_name_offset</code>, <code>annotation_name_side</code> and
<code>annotation_name_rot</code> control the style and position of the annotation names.
The latter three can be specified as named vectors. If
<code>annotation_name_offset</code> is specified as a named vector, it can be specified
as characters while not <code>unit</code> objects: <code>annotation_name_offset = c(foo = &quot;1cm&quot;)</code>.</p>
<p><code>gap</code> controls the space between every two neighbouring annotations. The value
can be a single unit or a vector of units.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, </a>
<a class="sourceLine" id="cb259-2" data-line-number="2">    <span class="dt">bar =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb259-3" data-line-number="3">    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb259-4" data-line-number="4">    <span class="dt">gap =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;mm&quot;</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-161-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb260-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, </a>
<a class="sourceLine" id="cb260-2" data-line-number="2">    <span class="dt">bar =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb260-3" data-line-number="3">    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb260-4" data-line-number="4">    <span class="dt">gap =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">10</span>), <span class="st">&quot;mm&quot;</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-163-1.png" width="576" style="display: block; margin: auto;" /></p>
<div id="size-of-annotations" class="section level3">
<h3><span class="header-section-number">3.18.1</span> Size of annotations</h3>
<p><code>height</code>, <code>width</code>, <code>annotation_height</code> and <code>annotation_width</code> control the
height or width of the complete heatmap annotations. Normally you don’t need
to set them because all the single annotations have fixed height/width and the
final height/width for the whole heatmap annotation is the sum of them.
Resizing these values will involve rather complicated adjustment depending on
whether it is a simple annotation or complex annotation. The resizing of
heatmap annotations will also happen when adjusting a list of heatmaps. In
following examples, we take column annotations as examples and demonstrate
some scenarios for the resizing adjustment.</p>
<p>First the default height of <code>ha</code>:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" data-line-number="1"><span class="co"># foo: 1cm, bar: 5mm, pt: 1cm</span></a>
<a class="sourceLine" id="cb261-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb261-3" data-line-number="3">    <span class="dt">bar =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb261-4" data-line-number="4">    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-165-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>If <code>height</code> is set, the size of the simple annotation will not change, while
only the complex annotations are adjusted. If there are multiple complex
annotations, they are adjusted according to the ratio of their original size.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb262-1" data-line-number="1"><span class="co"># foo: 1cm, bar: 5mm, pt: 4.5cm</span></a>
<a class="sourceLine" id="cb262-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb262-3" data-line-number="3">    <span class="dt">bar =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb262-4" data-line-number="4">    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb262-5" data-line-number="5">    <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">6</span>, <span class="st">&quot;cm&quot;</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-167-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><code>simple_anno_size</code> controls the height of all simple annotations. Recall
<code>ht_opt$simple_anno_size</code> can be set to globally control the size of simple
annotations in all heatmaps.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb263-1" data-line-number="1"><span class="co"># foo: 2cm, bar:1cm, pt: 3cm</span></a>
<a class="sourceLine" id="cb263-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb263-3" data-line-number="3">    <span class="dt">bar =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb263-4" data-line-number="4">    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb263-5" data-line-number="5">    <span class="dt">simple_anno_size =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;cm&quot;</span>), <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">6</span>, <span class="st">&quot;cm&quot;</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-169-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>If <code>annotation_height</code> is set as a vector of absolute units, the height of all
three annotations are adjusted accordingly.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb264-1" data-line-number="1"><span class="co"># foo: 1cm, bar: 2cm, pt: 3cm</span></a>
<a class="sourceLine" id="cb264-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb264-3" data-line-number="3">    <span class="dt">bar =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb264-4" data-line-number="4">    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb264-5" data-line-number="5">    <span class="dt">annotation_height =</span> <span class="kw">unit</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="st">&quot;cm&quot;</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-171-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>If <code>annotation_height</code> is set as pure numbers which is treated as relative
ratios for annotations, <code>height</code> should also be set as an absolute unit and
the size of every single annotation is adjusted by the ratios.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" data-line-number="1"><span class="co"># foo: 1cm, bar: 2cm, pt: 3cm</span></a>
<a class="sourceLine" id="cb265-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb265-3" data-line-number="3">    <span class="dt">bar =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb265-4" data-line-number="4">    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb265-5" data-line-number="5">    <span class="dt">annotation_height =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">6</span>, <span class="st">&quot;cm&quot;</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-172-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><code>annotation_height</code> can be mixed with relative units (in <code>null</code> unit) and
absolute units.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb266-1" data-line-number="1"><span class="co"># foo: 1.5cm, bar: 1.5cm, pt: 3cm</span></a>
<a class="sourceLine" id="cb266-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb266-3" data-line-number="3">    <span class="dt">bar =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb266-4" data-line-number="4">    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb266-5" data-line-number="5">    <span class="dt">annotation_height =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>), <span class="kw">c</span>(<span class="st">&quot;null&quot;</span>, <span class="st">&quot;null&quot;</span>, <span class="st">&quot;cm&quot;</span>)), <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">6</span>, <span class="st">&quot;cm&quot;</span>)</a>
<a class="sourceLine" id="cb266-6" data-line-number="6">)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-174-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb267-1" data-line-number="1"><span class="co"># foo: 2cm, bar: 1cm, pt: 3cm</span></a>
<a class="sourceLine" id="cb267-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb267-3" data-line-number="3">    <span class="dt">bar =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb267-4" data-line-number="4">    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb267-5" data-line-number="5">    <span class="dt">annotation_height =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>), <span class="kw">c</span>(<span class="st">&quot;cm&quot;</span>, <span class="st">&quot;null&quot;</span>, <span class="st">&quot;cm&quot;</span>)), <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">6</span>, <span class="st">&quot;cm&quot;</span>)</a>
<a class="sourceLine" id="cb267-6" data-line-number="6">)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-176-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>If there are only simple annotations, simply setting <code>height</code> won’t change the
height.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" data-line-number="1"><span class="co"># foo: 1cm, bar: 5mm</span></a>
<a class="sourceLine" id="cb268-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb268-3" data-line-number="3">    <span class="dt">bar =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb268-4" data-line-number="4">    <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">6</span>, <span class="st">&quot;cm&quot;</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-178-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>unless <code>simple_anno_size_adjust</code> is set to <code>TRUE</code>.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb269-1" data-line-number="1"><span class="co"># foo: 4cm, bar: 2cm</span></a>
<a class="sourceLine" id="cb269-2" data-line-number="2">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb269-3" data-line-number="3">    <span class="dt">bar =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb269-4" data-line-number="4">    <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">6</span>, <span class="st">&quot;cm&quot;</span>),</a>
<a class="sourceLine" id="cb269-5" data-line-number="5">    <span class="dt">simple_anno_size_adjust =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-180-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Section <a href="a-list-of-heatmaps.html#annotations-as-components-are-adjusted">4.6</a> introduces how the
annotation sizes are adjusted among a list of heatmaps.</p>
</div>
<div id="annotation-labels" class="section level3">
<h3><span class="header-section-number">3.18.2</span> Annotation labels</h3>
<p>From version 2.3.3, alternative labels for annotations can be set by <code>annotation_label</code> argument:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, </a>
<a class="sourceLine" id="cb270-2" data-line-number="2">    <span class="dt">bar =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb270-3" data-line-number="3">    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb270-4" data-line-number="4">    <span class="dt">annotation_label =</span> <span class="kw">c</span>(<span class="st">&quot;Annotation_foo&quot;</span>, <span class="st">&quot;Annotation_bar&quot;</span>, <span class="st">&quot;Annotation_pt&quot;</span>)</a>
<a class="sourceLine" id="cb270-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb270-6" data-line-number="6"><span class="kw">Heatmap</span>(<span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dv">10</span>), <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>, <span class="dt">top_annotation =</span> ha)</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-181-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="heatmap-annotation-utility-function" class="section level2">
<h2><span class="header-section-number">3.19</span> Utility functions</h2>
<p>There are some utility functions which make the manipulation of heatmap
annotation easier. Just see following examples.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb271-1" data-line-number="1">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, </a>
<a class="sourceLine" id="cb271-2" data-line-number="2">    <span class="dt">bar =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb271-3" data-line-number="3">    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</a>
<a class="sourceLine" id="cb271-4" data-line-number="4"><span class="kw">length</span>(ha)</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb273-1" data-line-number="1"><span class="kw">nobs</span>(ha)</a></code></pre></div>
<pre><code>## [1] 10</code></pre>
<p>Get or set the names of the annotations:</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb275-1" data-line-number="1"><span class="kw">names</span>(ha)</a></code></pre></div>
<pre><code>## [1] &quot;foo&quot; &quot;bar&quot; &quot;pt&quot;</code></pre>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb277-1" data-line-number="1"><span class="kw">names</span>(ha) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;FOO&quot;</span>, <span class="st">&quot;BAR&quot;</span>, <span class="st">&quot;PT&quot;</span>)</a>
<a class="sourceLine" id="cb277-2" data-line-number="2"><span class="kw">names</span>(ha)</a></code></pre></div>
<pre><code>## [1] &quot;FOO&quot; &quot;BAR&quot; &quot;PT&quot;</code></pre>
<p>You can concatenate two <code>HeatmapAnnotation</code> objects if they contain same
number of observations and different annotation names.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb279-1" data-line-number="1">ha1 =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, </a>
<a class="sourceLine" id="cb279-2" data-line-number="2">    <span class="dt">bar =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb279-3" data-line-number="3">    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</a>
<a class="sourceLine" id="cb279-4" data-line-number="4">ha2 =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">FOO =</span> <span class="kw">runif</span>(<span class="dv">10</span>), </a>
<a class="sourceLine" id="cb279-5" data-line-number="5">    <span class="dt">BAR =</span> <span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>), <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb279-6" data-line-number="6">    <span class="dt">PT =</span> <span class="kw">anno_points</span>(<span class="kw">rnorm</span>(<span class="dv">10</span>)))</a>
<a class="sourceLine" id="cb279-7" data-line-number="7">ha =<span class="st"> </span><span class="kw">c</span>(ha1, ha2)</a>
<a class="sourceLine" id="cb279-8" data-line-number="8"><span class="kw">names</span>(ha)</a></code></pre></div>
<pre><code>## [1] &quot;foo&quot; &quot;bar&quot; &quot;pt&quot;  &quot;FOO&quot; &quot;BAR&quot; &quot;PT&quot;</code></pre>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-185-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><code>HeatmapAnnoation</code> object sometimes is subsettable. The row index corresponds
to observations in the annotation and column index corresponds to the
annotations. If the annotations are all simple annotations or the complex
annotation created by <code>anno_*()</code> functions in <strong>ComplexHeatmap</strong> package, the
<code>HeatmapAnnotation</code> object is always subsettable.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" data-line-number="1">ha_subset =<span class="st"> </span>ha[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="kw">c</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;PT&quot;</span>)]</a>
<a class="sourceLine" id="cb281-2" data-line-number="2">ha_subset</a></code></pre></div>
<pre><code>## A HeatmapAnnotation object with 2 annotations
##   name: heatmap_annotation_96 
##   position: column 
##   items: 5 
##   width: 1npc 
##   height: 15.3514598035146mm 
##   this object is subsetable
##   5.21733333333333mm extension on the left 
##   6.75733333333333mm extension on the right 
## 
##  name   annotation_type color_mapping height
##   foo continuous vector        random    5mm
##    PT     anno_points()                 10mm</code></pre>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-187-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="implement-new-annotation-functions" class="section level2">
<h2><span class="header-section-number">3.20</span> Implement new annotation functions</h2>
<p>All the annotation functions defined in <strong>ComplexHeatmap</strong> are constructed by
the <code>AnnotationFunction</code> class. The <code>AnnotationFunction</code> class not only stores
the “real R function” which draws the graphics, it also calculates the spaces
caused by the annotation axis, more importantly, it allows splitting the
annotation graphics according to the split of the main heatmap.</p>
<p>As expected, the main part of the <code>AnnotationFunction</code> class is a function
which defines how to draw at specific positions which correspond to rows or
columns in the heatmap. The function should have three arguments: <code>index</code>, <code>k</code>
and <code>n</code> (the names of the arguments can be arbitrary) where <code>k</code> and <code>n</code> are
optional. <code>index</code> corresponds to the indices of rows or columns of the
heatmap. The value of <code>index</code> is not necessarily to be the whole row indices
or column indices in the heatmap. It can also be a subset of the indices if
the annotation is split into slices according to the split of the heatmap.
<code>index</code> is reordered according to the reordering of heatmap rows or columns
(e.g. by clustering). So, <code>index</code> actually contains a list of row or column
indices for the current slice after row or column reordering.</p>
<p>As mentioned, annotation can be split into slices. <code>k</code> corresponds to the
current slice and <code>n</code> corresponds to the total number of slices. The
annotation function draws in every slice repeatedly. The information of <code>k</code>
and <code>n</code> sometimes can be useful, for example, we want to add axis in the
annotation, and if it is a column annotation and axis is drawn on the very
right of the annotation area, the axis is only drawn when <code>k == n</code>.</p>
<p>Since the function only allows <code>index</code>, <code>k</code> and <code>n</code>, the function sometimes
uses several external variables which can not be defined inside the function,
e.g. the data points for the annotation. These variables should be imported
into the <code>AnnotationFunction</code> class by <code>var_import</code> so that the function can
correctly find these variables.</p>
<p>One important feature for <code>AnnotationFunction</code> class is it can be subsetable,
which is the base for splitting. To allow subsetting of the object, users need
to define the rule for the imported variables if there is any. The rules are
simple functions which accpet the variable and indices, and return the subset
of the variable. The subset rule functions implemented in this package are
<code>subset_gp()</code>, <code>subset_matrix_by_row()</code> and <code>subset_vector()</code>. If the
subsetting rule is not provided, it is inferred by the type of the object.</p>
<p>We first construct an <code>AnnotationFunction</code> object which needs external
variable and supports subsetting.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb283-1" data-line-number="1">x =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb283-2" data-line-number="2">anno1 =<span class="st"> </span><span class="kw">AnnotationFunction</span>(</a>
<a class="sourceLine" id="cb283-3" data-line-number="3">    <span class="dt">fun =</span> <span class="cf">function</span>(index, k, n) {</a>
<a class="sourceLine" id="cb283-4" data-line-number="4">        n =<span class="st"> </span><span class="kw">length</span>(index)</a>
<a class="sourceLine" id="cb283-5" data-line-number="5">        <span class="kw">pushViewport</span>(<span class="kw">viewport</span>(<span class="dt">xscale =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, n <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span>), <span class="dt">yscale =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)))</a>
<a class="sourceLine" id="cb283-6" data-line-number="6">        <span class="kw">grid.rect</span>()</a>
<a class="sourceLine" id="cb283-7" data-line-number="7">        <span class="kw">grid.points</span>(<span class="dv">1</span><span class="op">:</span>n, x[index], <span class="dt">default.units =</span> <span class="st">&quot;native&quot;</span>)</a>
<a class="sourceLine" id="cb283-8" data-line-number="8">        <span class="cf">if</span>(k <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="kw">grid.yaxis</span>()</a>
<a class="sourceLine" id="cb283-9" data-line-number="9">        <span class="kw">popViewport</span>()</a>
<a class="sourceLine" id="cb283-10" data-line-number="10">    },</a>
<a class="sourceLine" id="cb283-11" data-line-number="11">    <span class="dt">var_import =</span> <span class="kw">list</span>(<span class="dt">x =</span> x),</a>
<a class="sourceLine" id="cb283-12" data-line-number="12">    <span class="dt">n =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb283-13" data-line-number="13">    <span class="dt">subsetable =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb283-14" data-line-number="14">    <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;cm&quot;</span>)</a>
<a class="sourceLine" id="cb283-15" data-line-number="15">)</a>
<a class="sourceLine" id="cb283-16" data-line-number="16">anno1</a></code></pre></div>
<pre><code>## An AnnotationFunction object
##   function: user-defined
##   position: column 
##   items: 10 
##   width: 1npc 
##   height: 2cm 
##   imported variable: x 
##   this object is subsetable</code></pre>
<p>Then we can assign <code>anno1</code> in <code>HeatmapAnnotation()</code> function. Since <code>anno1</code> is
subsettable, you can split columns of the heatmap.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb285-1" data-line-number="1">m =<span class="st"> </span><span class="kw">rbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">11</span><span class="op">:</span><span class="dv">20</span>)</a>
<a class="sourceLine" id="cb285-2" data-line-number="2"><span class="kw">Heatmap</span>(m, <span class="dt">top_annotation =</span> <span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> anno1))</a>
<a class="sourceLine" id="cb285-3" data-line-number="3"><span class="kw">Heatmap</span>(m, <span class="dt">top_annotation =</span> <span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> anno1), </a>
<a class="sourceLine" id="cb285-4" data-line-number="4">    <span class="dt">column_split =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="dt">each =</span> <span class="dv">5</span>))</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-190-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>The second way is to put all data variables inside the function and no need to
import other variables.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb286-1" data-line-number="1"><span class="co"># code only for demonstration</span></a>
<a class="sourceLine" id="cb286-2" data-line-number="2">anno2 =<span class="st"> </span><span class="kw">AnnotationFunction</span>(</a>
<a class="sourceLine" id="cb286-3" data-line-number="3">    <span class="dt">fun =</span> <span class="cf">function</span>(index) {</a>
<a class="sourceLine" id="cb286-4" data-line-number="4">        x =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb286-5" data-line-number="5">        n =<span class="st"> </span><span class="kw">length</span>(index)</a>
<a class="sourceLine" id="cb286-6" data-line-number="6">        <span class="kw">pushViewport</span>(<span class="kw">viewport</span>())</a>
<a class="sourceLine" id="cb286-7" data-line-number="7">        <span class="kw">grid.points</span>(<span class="dv">1</span><span class="op">:</span>n, x[index])</a>
<a class="sourceLine" id="cb286-8" data-line-number="8">        <span class="kw">popViewport</span>()</a>
<a class="sourceLine" id="cb286-9" data-line-number="9">    },</a>
<a class="sourceLine" id="cb286-10" data-line-number="10">    <span class="dt">n =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb286-11" data-line-number="11">    <span class="dt">subsetable =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb286-12" data-line-number="12">)</a></code></pre></div>
<p>The most compact way to only specify the function to the constructor.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb287-1" data-line-number="1"><span class="co"># code only for demonstration</span></a>
<a class="sourceLine" id="cb287-2" data-line-number="2">anno3 =<span class="st"> </span><span class="kw">AnnotationFunction</span>(</a>
<a class="sourceLine" id="cb287-3" data-line-number="3">    <span class="dt">fun =</span> <span class="cf">function</span>(index) {</a>
<a class="sourceLine" id="cb287-4" data-line-number="4">        x =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb287-5" data-line-number="5">        n =<span class="st"> </span><span class="kw">length</span>(index)</a>
<a class="sourceLine" id="cb287-6" data-line-number="6">        <span class="kw">pushViewport</span>(<span class="kw">viewport</span>())</a>
<a class="sourceLine" id="cb287-7" data-line-number="7">        <span class="kw">grid.points</span>(<span class="dv">1</span><span class="op">:</span>n, x[index])</a>
<a class="sourceLine" id="cb287-8" data-line-number="8">        <span class="kw">popViewport</span>()</a>
<a class="sourceLine" id="cb287-9" data-line-number="9">    }</a>
<a class="sourceLine" id="cb287-10" data-line-number="10">)</a></code></pre></div>
<p>All the <code>anno_*()</code> functions introduced in this section actually are not
really annotation functions, while they are functions generating annotation
functions with specific configurations. However, users don’t need to be that
aware of.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb288-1" data-line-number="1"><span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a></code></pre></div>
<pre><code>## An AnnotationFunction object
##   function: anno_points()
##   position: column 
##   items: 10 
##   width: 1npc 
##   height: 1cm 
##   imported variable: data_scale, axis_param, border, size, value, pch_as_image, axis, gp, axis_grob, pch 
##   subsetable variable: gp, value, size, pch 
##   this object is subsetable
##   0mm extension on the bottom 
##   5.13831111111111mm extension on the left 
##   0mm extension on the top 
##   0mm extension on the right</code></pre>
<p>In most cases, you don’t need to manually construct your <code>AnnotationFunction</code>
objects. The annotation function <code>anno_*()</code> implemented in <strong>ComplexHeatmap</strong>
are already enough for most of the analysis tasks. On the other hand, users
can also use <code>anno_empty()</code> and <code>decorate_annotation()</code> to quickly add
self-defined annotation graphics. E.g. we can re-implement previous heatmap
as:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb290-1" data-line-number="1">ht =<span class="st"> </span><span class="kw">Heatmap</span>(m, <span class="dt">top_annotation =</span> <span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_empty</span>(<span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;cm&quot;</span>))), </a>
<a class="sourceLine" id="cb290-2" data-line-number="2">    <span class="dt">column_split =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="dt">each =</span> <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb290-3" data-line-number="3">ht =<span class="st"> </span><span class="kw">draw</span>(ht)</a>
<a class="sourceLine" id="cb290-4" data-line-number="4">co =<span class="st"> </span><span class="kw">column_order</span>(ht)</a>
<a class="sourceLine" id="cb290-5" data-line-number="5"><span class="kw">decorate_annotation</span>(<span class="st">&quot;foo&quot;</span>, <span class="dt">slice =</span> <span class="dv">1</span>, {</a>
<a class="sourceLine" id="cb290-6" data-line-number="6">    od =<span class="st"> </span>co[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb290-7" data-line-number="7">    <span class="kw">pushViewport</span>(<span class="kw">viewport</span>(<span class="dt">xscale =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="kw">length</span>(od) <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span>), <span class="dt">yscale =</span> <span class="kw">range</span>(x)))</a>
<a class="sourceLine" id="cb290-8" data-line-number="8">    <span class="kw">grid.points</span>(<span class="kw">seq_along</span>(od), x[od])</a>
<a class="sourceLine" id="cb290-9" data-line-number="9">    <span class="kw">grid.yaxis</span>()</a>
<a class="sourceLine" id="cb290-10" data-line-number="10">    <span class="kw">popViewport</span>()</a>
<a class="sourceLine" id="cb290-11" data-line-number="11">})</a>
<a class="sourceLine" id="cb290-12" data-line-number="12"><span class="kw">decorate_annotation</span>(<span class="st">&quot;foo&quot;</span>, <span class="dt">slice =</span> <span class="dv">2</span>, {</a>
<a class="sourceLine" id="cb290-13" data-line-number="13">    od =<span class="st"> </span>co[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb290-14" data-line-number="14">    <span class="kw">pushViewport</span>(<span class="kw">viewport</span>(<span class="dt">xscale =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="kw">length</span>(od) <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span>), <span class="dt">yscale =</span> <span class="kw">range</span>(x)))</a>
<a class="sourceLine" id="cb290-15" data-line-number="15">    <span class="kw">grid.points</span>(<span class="kw">seq_along</span>(od), x[od])</a>
<a class="sourceLine" id="cb290-16" data-line-number="16">    <span class="kw">popViewport</span>()</a>
<a class="sourceLine" id="cb290-17" data-line-number="17">})</a></code></pre></div>
<p><img src="03-heatmap_annotations_files/figure-html/unnamed-chunk-194-1.png" width="480" style="display: block; margin: auto;" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="a-single-heatmap.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="a-list-of-heatmaps.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jokergoo/ComplexHeatmap-reference/edit/master/03-heatmap_annotations.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ComplexHeatmap-reference.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
