<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Interactive ComplexHeatmap | ComplexHeatmap Complete Reference</title>
  <meta name="description" content="Complex heatmaps are efficient to visualize associations between different sources of data sets and reveal potential patterns. Here the ComplexHeatmap R package provides a highly flexible way to arrange multiple heatmaps and supports various annotation graphics. This book is the complete reference to ComplexHeatmap pacakge." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Interactive ComplexHeatmap | ComplexHeatmap Complete Reference" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://jokergoo.github.io/ComplexHeatmap-reference/book" />
  <meta property="og:image" content="https://jokergoo.github.io/ComplexHeatmap-reference/bookcomplexheatmap-cover.jpg" />
  <meta property="og:description" content="Complex heatmaps are efficient to visualize associations between different sources of data sets and reveal potential patterns. Here the ComplexHeatmap R package provides a highly flexible way to arrange multiple heatmaps and supports various annotation graphics. This book is the complete reference to ComplexHeatmap pacakge." />
  <meta name="github-repo" content="jokergoo/ComplexHeatmap-reference" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Interactive ComplexHeatmap | ComplexHeatmap Complete Reference" />
  
  <meta name="twitter:description" content="Complex heatmaps are efficient to visualize associations between different sources of data sets and reveal potential patterns. Here the ComplexHeatmap R package provides a highly flexible way to arrange multiple heatmaps and supports various annotation graphics. This book is the complete reference to ComplexHeatmap pacakge." />
  <meta name="twitter:image" content="https://jokergoo.github.io/ComplexHeatmap-reference/bookcomplexheatmap-cover.jpg" />

<meta name="author" content="Zuguang Gu" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="upset-plot.html"/>
<link rel="next" href="integrate-with-other-packages.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ComplexHeatmap Complete Reference</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#general-design"><i class="fa fa-check"></i><b>1.1</b> General design</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#a-brief-description-of-following-chapters"><i class="fa fa-check"></i><b>1.2</b> A brief description of following chapters</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html"><i class="fa fa-check"></i><b>2</b> A Single Heatmap</a>
<ul>
<li class="chapter" data-level="2.1" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#colors"><i class="fa fa-check"></i><b>2.1</b> Colors</a></li>
<li class="chapter" data-level="2.2" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#heatmap-titles"><i class="fa fa-check"></i><b>2.2</b> Titles</a></li>
<li class="chapter" data-level="2.3" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#clustering"><i class="fa fa-check"></i><b>2.3</b> Clustering</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#distance-methods"><i class="fa fa-check"></i><b>2.3.1</b> Distance methods</a></li>
<li class="chapter" data-level="2.3.2" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#clustering-methods"><i class="fa fa-check"></i><b>2.3.2</b> Clustering methods</a></li>
<li class="chapter" data-level="2.3.3" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#render-dendrograms"><i class="fa fa-check"></i><b>2.3.3</b> Render dendrograms</a></li>
<li class="chapter" data-level="2.3.4" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#reorder-dendrograms"><i class="fa fa-check"></i><b>2.3.4</b> Reorder dendrograms</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#row-and_column_orders"><i class="fa fa-check"></i><b>2.4</b> Set row and column orders</a></li>
<li class="chapter" data-level="2.5" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#heatmap-seriation"><i class="fa fa-check"></i><b>2.5</b> Seriation</a></li>
<li class="chapter" data-level="2.6" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#dimension-names"><i class="fa fa-check"></i><b>2.6</b> Dimension names</a></li>
<li class="chapter" data-level="2.7" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#heatmap-split"><i class="fa fa-check"></i><b>2.7</b> Heatmap split</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#split-by-kmeans-clustering"><i class="fa fa-check"></i><b>2.7.1</b> Split by k-means clustering</a></li>
<li class="chapter" data-level="2.7.2" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#split-by-categorical-variables"><i class="fa fa-check"></i><b>2.7.2</b> Split by categorical variables</a></li>
<li class="chapter" data-level="2.7.3" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#spilt-by-dendrogram"><i class="fa fa-check"></i><b>2.7.3</b> Split by dendrogram</a></li>
<li class="chapter" data-level="2.7.4" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#order-of-slices"><i class="fa fa-check"></i><b>2.7.4</b> Order of slices</a></li>
<li class="chapter" data-level="2.7.5" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#titles-for-splitting"><i class="fa fa-check"></i><b>2.7.5</b> Titles for splitting</a></li>
<li class="chapter" data-level="2.7.6" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#graphic-parameters-for-splitting"><i class="fa fa-check"></i><b>2.7.6</b> Graphic parameters for splitting</a></li>
<li class="chapter" data-level="2.7.7" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#gaps-between-slices"><i class="fa fa-check"></i><b>2.7.7</b> Gaps between slices</a></li>
<li class="chapter" data-level="2.7.8" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#split-heatmap-annotations"><i class="fa fa-check"></i><b>2.7.8</b> Split heatmap annotations</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#heatmap-as-raster-image"><i class="fa fa-check"></i><b>2.8</b> Heatmap as raster image</a></li>
<li class="chapter" data-level="2.9" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#customize-the-heatmap-body"><i class="fa fa-check"></i><b>2.9</b> Customize the heatmap body</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#cell-fun"><i class="fa fa-check"></i><b>2.9.1</b> cell_fun</a></li>
<li class="chapter" data-level="2.9.2" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#layer-fun"><i class="fa fa-check"></i><b>2.9.2</b> layer_fun</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#size-of-the-heatmap"><i class="fa fa-check"></i><b>2.10</b> Size of the heatmap</a></li>
<li class="chapter" data-level="2.11" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#plot-the-heatmap"><i class="fa fa-check"></i><b>2.11</b> Plot the heatmap</a></li>
<li class="chapter" data-level="2.12" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#get-orders-and-dendrograms-from-heatmap"><i class="fa fa-check"></i><b>2.12</b> Get orders and dendrograms</a></li>
<li class="chapter" data-level="2.13" data-path="a-single-heatmap.html"><a href="a-single-heatmap.html#subset-a-heatmap"><i class="fa fa-check"></i><b>2.13</b> Subset a heatmap</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html"><i class="fa fa-check"></i><b>3</b> Heatmap Annotations</a>
<ul>
<li class="chapter" data-level="3.1" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#simple-annotation"><i class="fa fa-check"></i><b>3.1</b> Simple annotation</a></li>
<li class="chapter" data-level="3.2" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#simple-annotation-as-an-annotation-function"><i class="fa fa-check"></i><b>3.2</b> Simple annotation as an annotation function</a></li>
<li class="chapter" data-level="3.3" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#empty-annotation"><i class="fa fa-check"></i><b>3.3</b> Empty annotation</a></li>
<li class="chapter" data-level="3.4" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#block-annotation"><i class="fa fa-check"></i><b>3.4</b> Block annotation</a></li>
<li class="chapter" data-level="3.5" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#image-annotation"><i class="fa fa-check"></i><b>3.5</b> Image annotation</a></li>
<li class="chapter" data-level="3.6" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#points-annotation"><i class="fa fa-check"></i><b>3.6</b> Points annotation</a></li>
<li class="chapter" data-level="3.7" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#lines-annotation"><i class="fa fa-check"></i><b>3.7</b> Lines annotation</a></li>
<li class="chapter" data-level="3.8" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#barplot_annotation"><i class="fa fa-check"></i><b>3.8</b> Barplot annotation</a></li>
<li class="chapter" data-level="3.9" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#box-annotation"><i class="fa fa-check"></i><b>3.9</b> Boxplot annotation</a></li>
<li class="chapter" data-level="3.10" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#histogram-annotation"><i class="fa fa-check"></i><b>3.10</b> Histogram annotation</a></li>
<li class="chapter" data-level="3.11" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#density-annotation"><i class="fa fa-check"></i><b>3.11</b> Density annotation</a></li>
<li class="chapter" data-level="3.12" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#joyplot-annotation"><i class="fa fa-check"></i><b>3.12</b> Joyplot annotation</a></li>
<li class="chapter" data-level="3.13" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#horizon-chart-annotation"><i class="fa fa-check"></i><b>3.13</b> Horizon chart annotation</a></li>
<li class="chapter" data-level="3.14" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#text-annotation"><i class="fa fa-check"></i><b>3.14</b> Text annotation</a></li>
<li class="chapter" data-level="3.15" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#mark-annotation"><i class="fa fa-check"></i><b>3.15</b> Mark annotation</a></li>
<li class="chapter" data-level="3.16" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#summary-annotation"><i class="fa fa-check"></i><b>3.16</b> Summary annotation</a></li>
<li class="chapter" data-level="3.17" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#zoom-annotation"><i class="fa fa-check"></i><b>3.17</b> Zoom/link annotation</a></li>
<li class="chapter" data-level="3.18" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#multiple-annotations"><i class="fa fa-check"></i><b>3.18</b> Multiple annotations</a>
<ul>
<li class="chapter" data-level="3.18.1" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#heatmap-annotation-general-settings"><i class="fa fa-check"></i><b>3.18.1</b> General settings</a></li>
<li class="chapter" data-level="3.18.2" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#size-of-annotations"><i class="fa fa-check"></i><b>3.18.2</b> Size of annotations</a></li>
<li class="chapter" data-level="3.18.3" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#annotation-labels"><i class="fa fa-check"></i><b>3.18.3</b> Annotation labels</a></li>
</ul></li>
<li class="chapter" data-level="3.19" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#heatmap-annotation-utility-function"><i class="fa fa-check"></i><b>3.19</b> Utility functions</a></li>
<li class="chapter" data-level="3.20" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#implement-new-annotation-functions"><i class="fa fa-check"></i><b>3.20</b> Implement new annotation functions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html"><i class="fa fa-check"></i><b>4</b> A List of Heatmaps</a>
<ul>
<li class="chapter" data-level="4.1" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#heatmap-list-titles"><i class="fa fa-check"></i><b>4.1</b> Titles</a></li>
<li class="chapter" data-level="4.2" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#size-of-heatmaps"><i class="fa fa-check"></i><b>4.2</b> Size of heatmaps</a></li>
<li class="chapter" data-level="4.3" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#gap-between-heatmaps"><i class="fa fa-check"></i><b>4.3</b> Gap between heatmaps</a></li>
<li class="chapter" data-level="4.4" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#automatic-adjustment-to-the-main-heatmap"><i class="fa fa-check"></i><b>4.4</b> Automatic adjustment to the main heatmap</a></li>
<li class="chapter" data-level="4.5" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#control-main-heatmap-in-draw-function"><i class="fa fa-check"></i><b>4.5</b> Control main heatmap in draw() function</a></li>
<li class="chapter" data-level="4.6" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#annotations-as-components-are-adjusted"><i class="fa fa-check"></i><b>4.6</b> Annotations as components are adjusted</a></li>
<li class="chapter" data-level="4.7" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#concatenate-with-annotations"><i class="fa fa-check"></i><b>4.7</b> Concatenate with annotations</a></li>
<li class="chapter" data-level="4.8" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#concatenate-only-the-annotations"><i class="fa fa-check"></i><b>4.8</b> Concatenate only the annotations</a></li>
<li class="chapter" data-level="4.9" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#vertical-concatenation"><i class="fa fa-check"></i><b>4.9</b> Vertical concatenation</a></li>
<li class="chapter" data-level="4.10" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#subset-heatmap-list"><i class="fa fa-check"></i><b>4.10</b> Subset the heatmap list</a></li>
<li class="chapter" data-level="4.11" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#plot-the-heamtap-list"><i class="fa fa-check"></i><b>4.11</b> Plot the heatmap list</a></li>
<li class="chapter" data-level="4.12" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#get-orders-and-dendrograms-from-a-list-of-heatmaps"><i class="fa fa-check"></i><b>4.12</b> Get orders and dendrograms</a></li>
<li class="chapter" data-level="4.13" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#change-parameters-globally"><i class="fa fa-check"></i><b>4.13</b> Change parameters globally</a></li>
<li class="chapter" data-level="4.14" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#adjust-blank-space-caused-by-annotations"><i class="fa fa-check"></i><b>4.14</b> Adjust blank space caused by annotations</a></li>
<li class="chapter" data-level="4.15" data-path="a-list-of-heatmaps.html"><a href="a-list-of-heatmaps.html#manually-increase-space-around-the-plot"><i class="fa fa-check"></i><b>4.15</b> Manually increase space around the plot</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="legends.html"><a href="legends.html"><i class="fa fa-check"></i><b>5</b> Legends</a>
<ul>
<li class="chapter" data-level="5.1" data-path="legends.html"><a href="legends.html#continuous-legends"><i class="fa fa-check"></i><b>5.1</b> Continuous legends</a></li>
<li class="chapter" data-level="5.2" data-path="legends.html"><a href="legends.html#discrete-legends"><i class="fa fa-check"></i><b>5.2</b> Discrete legends</a></li>
<li class="chapter" data-level="5.3" data-path="legends.html"><a href="legends.html#a-list-of-legends"><i class="fa fa-check"></i><b>5.3</b> A list of legends</a></li>
<li class="chapter" data-level="5.4" data-path="legends.html"><a href="legends.html#heatmap-and-annotation-legends"><i class="fa fa-check"></i><b>5.4</b> Heatmap and annotation legends</a></li>
<li class="chapter" data-level="5.5" data-path="legends.html"><a href="legends.html#add-customized-legends"><i class="fa fa-check"></i><b>5.5</b> Add customized legends</a></li>
<li class="chapter" data-level="5.6" data-path="legends.html"><a href="legends.html#the-side-of-legends"><i class="fa fa-check"></i><b>5.6</b> The side of legends</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html"><i class="fa fa-check"></i><b>6</b> Heatmap Decoration</a>
<ul>
<li class="chapter" data-level="6.1" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html#decoration-functions"><i class="fa fa-check"></i><b>6.1</b> Decoration functions</a></li>
<li class="chapter" data-level="6.2" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html#decoration-examples"><i class="fa fa-check"></i><b>6.2</b> Examples</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html#barplot-for-single-column-heatmap"><i class="fa fa-check"></i><b>6.2.1</b> Barplot for single-column heatmap</a></li>
<li class="chapter" data-level="6.2.2" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html#add-titles-for-row-annotations"><i class="fa fa-check"></i><b>6.2.2</b> Add titles for row annotations</a></li>
<li class="chapter" data-level="6.2.3" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html#other-possible-use-of-decorations"><i class="fa fa-check"></i><b>6.2.3</b> Other possible use of decorations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="oncoprint.html"><a href="oncoprint.html"><i class="fa fa-check"></i><b>7</b> OncoPrint</a>
<ul>
<li class="chapter" data-level="7.1" data-path="oncoprint.html"><a href="oncoprint.html#oncoprint-general-settings"><i class="fa fa-check"></i><b>7.1</b> General settings</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="oncoprint.html"><a href="oncoprint.html#input-data-format"><i class="fa fa-check"></i><b>7.1.1</b> Input data format</a></li>
<li class="chapter" data-level="7.1.2" data-path="oncoprint.html"><a href="oncoprint.html#define-the-alter-fun"><i class="fa fa-check"></i><b>7.1.2</b> Define the alter_fun()</a></li>
<li class="chapter" data-level="7.1.3" data-path="oncoprint.html"><a href="oncoprint.html#oncoprint-background"><i class="fa fa-check"></i><b>7.1.3</b> Background</a></li>
<li class="chapter" data-level="7.1.4" data-path="oncoprint.html"><a href="oncoprint.html#complex-alteration-types"><i class="fa fa-check"></i><b>7.1.4</b> Complex alteration types</a></li>
<li class="chapter" data-level="7.1.5" data-path="oncoprint.html"><a href="oncoprint.html#simplify-alter_fun"><i class="fa fa-check"></i><b>7.1.5</b> Simplify alter_fun</a></li>
<li class="chapter" data-level="7.1.6" data-path="oncoprint.html"><a href="oncoprint.html#other-heatmap-related-settings"><i class="fa fa-check"></i><b>7.1.6</b> Other heatmap-related settings</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="oncoprint.html"><a href="oncoprint.html#apply-to-cbioportal-dataset"><i class="fa fa-check"></i><b>7.2</b> Apply to cBioPortal dataset</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="oncoprint.html"><a href="oncoprint.html#remove-empty-rows-and-columns"><i class="fa fa-check"></i><b>7.2.1</b> Remove empty rows and columns</a></li>
<li class="chapter" data-level="7.2.2" data-path="oncoprint.html"><a href="oncoprint.html#reorder-the-oncoprint"><i class="fa fa-check"></i><b>7.2.2</b> Reorder the oncoPrint</a></li>
<li class="chapter" data-level="7.2.3" data-path="oncoprint.html"><a href="oncoprint.html#oncoprint-annotations"><i class="fa fa-check"></i><b>7.2.3</b> OncoPrint annotations</a></li>
<li class="chapter" data-level="7.2.4" data-path="oncoprint.html"><a href="oncoprint.html#oncoprint-as-a-heatmap"><i class="fa fa-check"></i><b>7.2.4</b> oncoPrint as a Heatmap</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="upset-plot.html"><a href="upset-plot.html"><i class="fa fa-check"></i><b>8</b> UpSet plot</a>
<ul>
<li class="chapter" data-level="8.1" data-path="upset-plot.html"><a href="upset-plot.html#input-data"><i class="fa fa-check"></i><b>8.1</b> Input data</a></li>
<li class="chapter" data-level="8.2" data-path="upset-plot.html"><a href="upset-plot.html#upset-mode"><i class="fa fa-check"></i><b>8.2</b> Mode</a></li>
<li class="chapter" data-level="8.3" data-path="upset-plot.html"><a href="upset-plot.html#make-the-combination-matrix"><i class="fa fa-check"></i><b>8.3</b> Make the combination matrix</a></li>
<li class="chapter" data-level="8.4" data-path="upset-plot.html"><a href="upset-plot.html#upset-utility-functions"><i class="fa fa-check"></i><b>8.4</b> Utility functions</a></li>
<li class="chapter" data-level="8.5" data-path="upset-plot.html"><a href="upset-plot.html#upset-making-the-plot"><i class="fa fa-check"></i><b>8.5</b> Make the plot</a></li>
<li class="chapter" data-level="8.6" data-path="upset-plot.html"><a href="upset-plot.html#upset-plots-as-heatmaps"><i class="fa fa-check"></i><b>8.6</b> UpSet plots as heatmaps</a></li>
<li class="chapter" data-level="8.7" data-path="upset-plot.html"><a href="upset-plot.html#example-with-the-movies-dataset"><i class="fa fa-check"></i><b>8.7</b> Example with the movies dataset</a></li>
<li class="chapter" data-level="8.8" data-path="upset-plot.html"><a href="upset-plot.html#example-with-the-genomic-regions"><i class="fa fa-check"></i><b>8.8</b> Example with the genomic regions</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="interactive.html"><a href="interactive.html"><i class="fa fa-check"></i><b>9</b> Interactive ComplexHeatmap</a>
<ul>
<li class="chapter" data-level="9.1" data-path="interactive.html"><a href="interactive.html#on-the-interactive-graphics-device"><i class="fa fa-check"></i><b>9.1</b> On the interactive graphics device</a></li>
<li class="chapter" data-level="9.2" data-path="interactive.html"><a href="interactive.html#on-other-devices"><i class="fa fa-check"></i><b>9.2</b> On other devices</a></li>
<li class="chapter" data-level="9.3" data-path="interactive.html"><a href="interactive.html#shiny-app"><i class="fa fa-check"></i><b>9.3</b> Shiny app</a></li>
<li class="chapter" data-level="9.4" data-path="interactive.html"><a href="interactive.html#implement-a-shiny-app-from-scratch"><i class="fa fa-check"></i><b>9.4</b> Implement a Shiny app from scratch</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="integrate-with-other-packages.html"><a href="integrate-with-other-packages.html"><i class="fa fa-check"></i><b>10</b> Integrate with other packages</a>
<ul>
<li class="chapter" data-level="10.1" data-path="integrate-with-other-packages.html"><a href="integrate-with-other-packages.html#pheatmap"><i class="fa fa-check"></i><b>10.1</b> pheatmap</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="integrate-with-other-packages.html"><a href="integrate-with-other-packages.html#examples"><i class="fa fa-check"></i><b>10.1.1</b> Examples</a></li>
<li class="chapter" data-level="10.1.2" data-path="integrate-with-other-packages.html"><a href="integrate-with-other-packages.html#translation"><i class="fa fa-check"></i><b>10.1.2</b> Translation</a></li>
<li class="chapter" data-level="10.1.3" data-path="integrate-with-other-packages.html"><a href="integrate-with-other-packages.html#comparisons"><i class="fa fa-check"></i><b>10.1.3</b> Comparisons</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="integrate-with-other-packages.html"><a href="integrate-with-other-packages.html#cowplot"><i class="fa fa-check"></i><b>10.2</b> cowplot</a></li>
<li class="chapter" data-level="10.3" data-path="integrate-with-other-packages.html"><a href="integrate-with-other-packages.html#gridtext"><i class="fa fa-check"></i><b>10.3</b> gridtext</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="integrate-with-other-packages.html"><a href="integrate-with-other-packages.html#gridtext-title"><i class="fa fa-check"></i><b>10.3.1</b> Titles</a></li>
<li class="chapter" data-level="10.3.2" data-path="integrate-with-other-packages.html"><a href="integrate-with-other-packages.html#gridtext-dimnames"><i class="fa fa-check"></i><b>10.3.2</b> Row/column names</a></li>
<li class="chapter" data-level="10.3.3" data-path="integrate-with-other-packages.html"><a href="integrate-with-other-packages.html#gridtext-annotations"><i class="fa fa-check"></i><b>10.3.3</b> Annotation labels</a></li>
<li class="chapter" data-level="10.3.4" data-path="integrate-with-other-packages.html"><a href="integrate-with-other-packages.html#gridtext-anno-text"><i class="fa fa-check"></i><b>10.3.4</b> Text annotation</a></li>
<li class="chapter" data-level="10.3.5" data-path="integrate-with-other-packages.html"><a href="integrate-with-other-packages.html#gridtext-legends"><i class="fa fa-check"></i><b>10.3.5</b> Legend</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="other-high-level-plots.html"><a href="other-high-level-plots.html"><i class="fa fa-check"></i><b>11</b> Other High-level Plots</a>
<ul>
<li class="chapter" data-level="11.1" data-path="other-high-level-plots.html"><a href="other-high-level-plots.html#density-heatmap"><i class="fa fa-check"></i><b>11.1</b> Density heatmap</a></li>
<li class="chapter" data-level="11.2" data-path="other-high-level-plots.html"><a href="other-high-level-plots.html#stacked-summary-plot"><i class="fa fa-check"></i><b>11.2</b> Stacked summary plot</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="more-examples.html"><a href="more-examples.html"><i class="fa fa-check"></i><b>12</b> More Examples</a>
<ul>
<li class="chapter" data-level="12.1" data-path="more-examples.html"><a href="more-examples.html#add-more-information-for-gene-expression-matrix"><i class="fa fa-check"></i><b>12.1</b> Add more information for gene expression matrix</a></li>
<li class="chapter" data-level="12.2" data-path="more-examples.html"><a href="more-examples.html#the-measles-vaccine-heatmap"><i class="fa fa-check"></i><b>12.2</b> The measles vaccine heatmap</a></li>
<li class="chapter" data-level="12.3" data-path="more-examples.html"><a href="more-examples.html#visualize-cell-heterogeneity-from-single-cell-rnaseq"><i class="fa fa-check"></i><b>12.3</b> Visualize Cell Heterogeneity from Single Cell RNASeq</a></li>
<li class="chapter" data-level="12.4" data-path="more-examples.html"><a href="more-examples.html#correlations-between-methylation-expression-and-other-genomic-features"><i class="fa fa-check"></i><b>12.4</b> Correlations between methylation, expression and other genomic features</a></li>
<li class="chapter" data-level="12.5" data-path="more-examples.html"><a href="more-examples.html#visualize-methylation-profile-with-complex-annotations"><i class="fa fa-check"></i><b>12.5</b> Visualize Methylation Profile with Complex Annotations</a></li>
<li class="chapter" data-level="12.6" data-path="more-examples.html"><a href="more-examples.html#add-multiple-boxplots-for-single-row"><i class="fa fa-check"></i><b>12.6</b> Add multiple boxplots for single row</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="other-tricks.html"><a href="other-tricks.html"><i class="fa fa-check"></i><b>13</b> Other Tricks</a>
<ul>
<li class="chapter" data-level="13.1" data-path="other-tricks.html"><a href="other-tricks.html#set-the-same-cell-size-for-different-heatmaps-with-different-dimensions"><i class="fa fa-check"></i><b>13.1</b> Set the same cell size for different heatmaps with different dimensions</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">ComplexHeatmap Complete Reference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="interactive" class="section level1" number="9">
<h1><span class="header-section-number">Chapter 9</span> Interactive ComplexHeatmap</h1>
<p>Heatmaps are mainly for visualizing common patterns that are shared by groups
of rows and columns. After the patterns have been seen, the next step is to
extract the corresponding rows and columns from the heatmap, which requires
interactivity on the heatmaps. <strong>ComplexHeatmap</strong> package is used for
generating static heatmaps. <strong>From version 2.5.3, it is now possible to make
complex heatmaps interactive!</strong> The new functionalities allow users
to capture sub-heatmaps by clicking or selecting areas from heatmaps.</p>
<p>To demonstrate this new functionality, I first generate two heatmaps and apply
<em>k</em>-means clustering on the numeric one.</p>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb620-1"><a href="interactive.html#cb620-1"></a><span class="kw">library</span>(ComplexHeatmap)</span>
<span id="cb620-2"><a href="interactive.html#cb620-2"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb620-3"><a href="interactive.html#cb620-3"></a>mat1 =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dv">10</span>)</span>
<span id="cb620-4"><a href="interactive.html#cb620-4"></a><span class="kw">rownames</span>(mat1) =<span class="st"> </span><span class="kw">colnames</span>(mat1) =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb620-5"><a href="interactive.html#cb620-5"></a>mat2 =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>], <span class="dv">100</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>), <span class="dv">10</span>)</span>
<span id="cb620-6"><a href="interactive.html#cb620-6"></a><span class="kw">rownames</span>(mat2) =<span class="st"> </span><span class="kw">colnames</span>(mat2) =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;b&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb620-7"><a href="interactive.html#cb620-7"></a></span>
<span id="cb620-8"><a href="interactive.html#cb620-8"></a>ht_list =<span class="st"> </span><span class="kw">Heatmap</span>(mat1, <span class="dt">name =</span> <span class="st">&quot;mat_a&quot;</span>, <span class="dt">row_km =</span> <span class="dv">2</span>, <span class="dt">column_km =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb620-9"><a href="interactive.html#cb620-9"></a><span class="st">    </span><span class="kw">Heatmap</span>(mat2, <span class="dt">name =</span> <span class="st">&quot;mat_b&quot;</span>)</span></code></pre></div>
<p><strong>ComplexHeatmap</strong> package allows two types of interactivity: 1. on the
interactive graphics device and 2. on a Shiny app.</p>
<div id="on-the-interactive-graphics-device" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> On the interactive graphics device</h2>
<p>Here the “interactive graphics device” is the window that is opened for generating
plots in your R session, or the figure panel in Rstudio IDE.</p>
<p>In the following parts of this post, I will explain how the correspondance
between the points user selected and the values in the heatmap/matrix is done
in <strong>ComplexHeatmap</strong> package.</p>
<p>When user clicks on the device, the physical locations relative in the device
are captured by <code>grid::grid.locator()</code>. The physical locations of the heatmaps
(more precisely, the heatmap slices) are also captured via the new
<code>ht_pos_on_device()</code> function (thanks to <code>grid::deviceLoc()</code>).</p>
<p>Before executing <code>ht_pos_on_device()</code>, the heatmap should be drawn on the
device and the layout of heatmaps should have been done, thus, the heatmap object
<code>ht_list</code> should be updated explictly by the <code>draw()</code> function.</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="interactive.html#cb621-1"></a>ht_list =<span class="st"> </span><span class="kw">draw</span>(ht_list)</span>
<span id="cb621-2"><a href="interactive.html#cb621-2"></a>pos =<span class="st"> </span><span class="kw">ht_pos_on_device</span>(ht_list)</span></code></pre></div>
<p><img src="09-interactive_files/figure-html/unnamed-chunk-2-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The returned object <code>pos</code> is a <code>DataFrame</code> object that contains the positions
of all heatmap slices. A <code>DataFrame</code> object (the <code>DataFrame</code> class is defined
in <strong>S4Vectors</strong> package from
<a href="https://bioconductor.org/packages/release/bioc/html/S4Vectors.html">Bioconductor</a>)
is bacially very similar as a data frame, but it can store more complex data
types, such as the <code>simpleUnit</code> (generated by <code>grid::unit()</code>) vectors as in <code>pos</code>
(click the “show/hide output” button to see the output).</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="interactive.html#cb622-1"></a>pos</span></code></pre></div>
<pre><code>## DataFrame with 6 rows and 8 columns
##       heatmap                  slice row_slice column_slice
##   &lt;character&gt;            &lt;character&gt; &lt;integer&gt;    &lt;integer&gt;
## 1       mat_a mat_a_heatmap_body_1_1         1            1
## 2       mat_a mat_a_heatmap_body_1_2         1            2
## 3       mat_a mat_a_heatmap_body_2_1         2            1
## 4       mat_a mat_a_heatmap_body_2_2         2            2
## 5       mat_b mat_b_heatmap_body_1_1         1            1
## 6       mat_b mat_b_heatmap_body_2_1         2            1
##                     x_min                  x_max                  y_min
##              &lt;simpleUnit&gt;           &lt;simpleUnit&gt;           &lt;simpleUnit&gt;
## 1 0.736349162910223inches 1.78273889506765inches 1.03050115700316inches
## 2  1.82210897380781inches 2.86849870596523inches 1.03050115700316inches
## 3 0.736349162910223inches 1.78273889506765inches 0.43284365824135inches
## 4  1.82210897380781inches 2.86849870596523inches 0.43284365824135inches
## 5  2.94723886344555inches 5.07938840650056inches 1.03050115700316inches
## 6  2.94723886344555inches 5.07938840650056inches 0.43284365824135inches
##                     y_max
##              &lt;simpleUnit&gt;
## 1  3.26365083708978inches
## 2  3.26365083708978inches
## 3 0.991131078263004inches
## 4 0.991131078263004inches
## 5  3.26365083708978inches
## 6 0.991131078263004inches</code></pre>
<p>We can confirm whether the positions are correctly captured by the following
code. In the next figure, black rectangles correspond to the heatmap slices
and the dashed rectangle corresponds to the border of the whole image.</p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="interactive.html#cb624-1"></a><span class="co"># If you try the code in your interactive R session, you need the following </span></span>
<span id="cb624-2"><a href="interactive.html#cb624-2"></a><span class="co"># two lines to open a new device with the same size as the current one.</span></span>
<span id="cb624-3"><a href="interactive.html#cb624-3"></a><span class="co"># ds = dev.size()</span></span>
<span id="cb624-4"><a href="interactive.html#cb624-4"></a><span class="co"># dev.new(width = ds[1], height = ds[2])</span></span>
<span id="cb624-5"><a href="interactive.html#cb624-5"></a><span class="kw">grid.newpage</span>()</span>
<span id="cb624-6"><a href="interactive.html#cb624-6"></a><span class="kw">grid.rect</span>(<span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">lty =</span> <span class="dv">2</span>))</span>
<span id="cb624-7"><a href="interactive.html#cb624-7"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_len</span>(<span class="kw">nrow</span>(pos))) {</span>
<span id="cb624-8"><a href="interactive.html#cb624-8"></a>	x_min =<span class="st"> </span>pos[i, <span class="st">&quot;x_min&quot;</span>]</span>
<span id="cb624-9"><a href="interactive.html#cb624-9"></a>	x_max =<span class="st"> </span>pos[i, <span class="st">&quot;x_max&quot;</span>]</span>
<span id="cb624-10"><a href="interactive.html#cb624-10"></a>	y_min =<span class="st"> </span>pos[i, <span class="st">&quot;y_min&quot;</span>]</span>
<span id="cb624-11"><a href="interactive.html#cb624-11"></a>	y_max =<span class="st"> </span>pos[i, <span class="st">&quot;y_max&quot;</span>]</span>
<span id="cb624-12"><a href="interactive.html#cb624-12"></a>	<span class="kw">pushViewport</span>(<span class="kw">viewport</span>(<span class="dt">x =</span> x_min, <span class="dt">y =</span> y_min, <span class="dt">name =</span> pos[i, <span class="st">&quot;slice&quot;</span>],</span>
<span id="cb624-13"><a href="interactive.html#cb624-13"></a>		<span class="dt">width =</span> x_max <span class="op">-</span><span class="st"> </span>x_min, <span class="dt">height =</span> y_max <span class="op">-</span><span class="st"> </span>y_min,</span>
<span id="cb624-14"><a href="interactive.html#cb624-14"></a>		<span class="dt">just =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>)))</span>
<span id="cb624-15"><a href="interactive.html#cb624-15"></a>	<span class="kw">grid.rect</span>()</span>
<span id="cb624-16"><a href="interactive.html#cb624-16"></a>	<span class="kw">upViewport</span>()</span>
<span id="cb624-17"><a href="interactive.html#cb624-17"></a>}</span></code></pre></div>
<p><img src="09-interactive_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Since now we know the location of the point that user clicked and the positions
of all heatmap slices, it is possible to calculate which row and which column in
the original matrix user’s point corresponds to.</p>
<p>In the next figure, the blue point with the coordinate <span class="math inline">\((a, b)\)</span> is
clicked by user. The heatmap slice where user clicked into has range <span class="math inline">\((x_1,x_2)\)</span>
on x direction and range <span class="math inline">\((y_1, y_2)\)</span> on y direction. There are <span class="math inline">\(n_r\)</span>
rows (<span class="math inline">\(n_r =8\)</span>) and <span class="math inline">\(n_c\)</span> columns (<span class="math inline">\(n_c = 5\)</span>) in this heatmap slice and they are marked
by dashed lines.</p>
<p><img src="09-interactive_files/figure-html/unnamed-chunk-5-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Relative in this heatmap slice, the row index <span class="math inline">\(i_r\)</span> and column index <span class="math inline">\(i_c\)</span> of
the cell where the point is in can be calculated as:</p>
<p><span class="math display">\[ i_c = \lceil \frac{a - x_1}{x_2 - x_1} \cdot n_c \rceil \]</span>
<span class="math display">\[ i_r = \lceil \frac{b - y_1}{y_2 - y_1} \cdot n_r \rceil \]</span></p>
<p>where the symbol <span class="math inline">\(\lceil x \rceil\)</span> means the ceiling of the numeric value <span class="math inline">\(x\)</span>.
If the row on the top has the index of 1, then <span class="math inline">\(i_r\)</span> should be calculated as:</p>
<p><span class="math display">\[ i_r = n_r - \lceil \frac{b - y_1}{y_2 - y_1} \cdot n_r \rceil + 1 \]</span></p>
<p>The subset of row and column indices of the original matrix that belongs to
the selected heatmap slice is already stored in <code>ht_list</code> object, thus, we can
obtain the row and column index of the original matrix that corresponds to
user’s point easily with <span class="math inline">\(i_r\)</span> and <span class="math inline">\(i_c\)</span>.</p>
<p><strong>ComplexHeatmap</strong> package now has two new functions <code>selectPosition()</code> and
<code>selectArea()</code> which allows users to pick single positions or select areas
from the heatmaps. Under the interactive graphics device, users do not need to
run <code>ht_pos_on_device()</code> explicitly. The positions of heatmaps are
automatically calculated, cached and reused if the heatmaps are the same and
the device has not changed its size.</p>
<p>The next image shows an example of using <code>selectPosition()</code>. Interactively,
the function asks user to click one position on the heatmap. The function
returns a <code>DataFrame</code> which contains the heatmap name, slice name and the
row/column index of the matrix in that heatmap. An example output can be found
by clicking the button below.</p>
<pre><code>## DataFrame with 1 row and 6 columns
##       heatmap                  slice row_slice column_slice row_index
##   &lt;character&gt;            &lt;character&gt; &lt;numeric&gt;    &lt;numeric&gt; &lt;integer&gt;
## 1       mat_a mat_a_heatmap_body_1_2         1            2         9
##   column_index
##      &lt;integer&gt;
## 1            1</code></pre>
<p>If the position clicked is not in any of the heatmap slices, the function
returns <code>NULL</code>.</p>
<p>
<img width='100%' style='border:1px solid grey;padding: 4px;'  src='https://user-images.githubusercontent.com/449218/82155004-29035780-9872-11ea-849d-20b15014c451.gif' />
</p>
<p>Similarly, the <code>selectArea()</code> function asks user to click two positions on the
heatmap which defines an area. Note since the selected area may overlap over
multiple heatmaps and slices, the function returns a <code>DataFrame</code> with multiple
rows which contains the heatmap names, slice names and the row/column indices
in that heatmap. An example output can be found by clicking the button below.</p>
<pre><code>## DataFrame with 4 rows and 6 columns
##       heatmap                  slice row_slice column_slice     row_index
##   &lt;character&gt;            &lt;character&gt; &lt;numeric&gt;    &lt;numeric&gt; &lt;IntegerList&gt;
## 1       mat_a mat_a_heatmap_body_1_2         1            2     7,5,2,...
## 2       mat_a mat_a_heatmap_body_2_2         2            2           6,3
## 3       mat_b mat_b_heatmap_body_1_1         1            1     7,5,2,...
## 4       mat_b mat_b_heatmap_body_2_1         2            1           6,3
##    column_index
##   &lt;IntegerList&gt;
## 1     2,4,1,...
## 2     2,4,1,...
## 3     1,2,3,...
## 4     1,2,3,...</code></pre>
<p>The columns <code>row_index</code> and <code>column_index</code> are stored in <code>IntegerList</code> format.
To get the row indices in <em>e.g.</em> <code>mat_a_heatmap_body_1_2</code> (in the first row), user should use one
of the following code (assume the <code>DataFrame</code> object is called <code>df</code>):</p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="interactive.html#cb627-1"></a>df[<span class="dv">1</span>, <span class="st">&quot;row_index&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb627-2"><a href="interactive.html#cb627-2"></a><span class="kw">unlist</span>(df[<span class="dv">1</span>, <span class="st">&quot;row_index&quot;</span>])</span>
<span id="cb627-3"><a href="interactive.html#cb627-3"></a>df<span class="op">$</span>row_index[[<span class="dv">1</span>]]</span></code></pre></div>
<p>The rectangle and the points that mark the area can be turned off by setting
<code>mark</code> argument to <code>FALSE</code>.</p>
<p>
<img width='100%' style='border:1px solid grey;padding: 4px;' src='https://user-images.githubusercontent.com/449218/82155001-23a60d00-9872-11ea-8e28-4c956e40a5e9.gif' />
</p>
</div>
<div id="on-other-devices" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> On other devices</h2>
<p>It is also possible to use on other non-interactive graphics devices, such as
<code>pdf()</code> or <code>png()</code>. Now you cannot select the positions interactively, but
instead you should specify <code>pos</code> argument in <code>selectPosition()</code> and
<code>pos1</code>/<code>pos2</code> in <code>selectArea()</code>. The values for <code>pos</code>, <code>pos1</code> and <code>pos2</code>
all should be a <code>unit</code> object of length two which correspond to the x and y
coordinate of the positions.</p>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb628-1"><a href="interactive.html#cb628-1"></a><span class="co"># pdf(...) or png(...) or other graphics devices</span></span>
<span id="cb628-2"><a href="interactive.html#cb628-2"></a>ht_list =<span class="st"> </span><span class="kw">draw</span>(ht_list)</span>
<span id="cb628-3"><a href="interactive.html#cb628-3"></a>pos =<span class="st"> </span><span class="kw">selectPosition</span>(ht_list, <span class="dt">pos =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>), <span class="st">&quot;cm&quot;</span>))</span></code></pre></div>
<p><img src="09-interactive_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;" /></p>
<pre><code>##   Point: x = 3.0 cm, y = 3.0 cm (measured in the graphics device)
## 
## The heatmaps have been changed. Calcualte the new heatmap positions.
## Search in heatmap &#39;mat_a&#39;
##   - row slice 1, column slice 1 [mat_a_heatmap_body_1_1]... overlap</code></pre>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb630-1"><a href="interactive.html#cb630-1"></a>pos</span></code></pre></div>
<pre><code>## DataFrame with 1 row and 6 columns
##       heatmap                  slice row_slice column_slice row_index
##   &lt;character&gt;            &lt;character&gt; &lt;numeric&gt;    &lt;numeric&gt; &lt;integer&gt;
## 1       mat_a mat_a_heatmap_body_1_1         1            1         8
##   column_index
##      &lt;integer&gt;
## 1            7</code></pre>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb632-1"><a href="interactive.html#cb632-1"></a><span class="co"># remember to dev.off()</span></span></code></pre></div>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="interactive.html#cb633-1"></a><span class="co"># pdf(...) or png(...) or other graphics devices</span></span>
<span id="cb633-2"><a href="interactive.html#cb633-2"></a>ht_list =<span class="st"> </span><span class="kw">draw</span>(ht_list)</span>
<span id="cb633-3"><a href="interactive.html#cb633-3"></a>pos =<span class="st"> </span><span class="kw">selectArea</span>(ht_list, <span class="dt">pos1 =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>), <span class="st">&quot;cm&quot;</span>), <span class="dt">pos2 =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="st">&quot;cm&quot;</span>))</span></code></pre></div>
<p><img src="09-interactive_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;" /></p>
<pre><code>##   Point 1: x = 3.0 cm, y = 3.0 cm (measured in the graphics device)
##   Point 2: x = 5.0 cm, y = 5.0 cm (measured in the graphic device)
## 
## Heatmap positions are already calculated, use the cached one.
## Search in heatmap &#39;mat_a&#39;
##   - row slice 1, column slice 1 [mat_a_heatmap_body_1_1]... overlap
## Search in heatmap &#39;mat_a&#39;
##   - row slice 1, column slice 2 [mat_a_heatmap_body_1_2]... overlap
## Search in heatmap &#39;mat_a&#39;
##   - row slice 2, column slice 1 [mat_a_heatmap_body_2_1]... no overlap
## Search in heatmap &#39;mat_a&#39;
##   - row slice 2, column slice 2 [mat_a_heatmap_body_2_2]... no overlap
## Search in heatmap &#39;mat_b&#39;
##   - row slice 1, column slice 1 [mat_b_heatmap_body_1_1]... no overlap
## Search in heatmap &#39;mat_b&#39;
##   - row slice 2, column slice 1 [mat_b_heatmap_body_2_1]... no overlap</code></pre>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="interactive.html#cb635-1"></a>pos</span></code></pre></div>
<pre><code>## DataFrame with 2 rows and 6 columns
##       heatmap                  slice row_slice column_slice     row_index
##   &lt;character&gt;            &lt;character&gt; &lt;numeric&gt;    &lt;numeric&gt; &lt;IntegerList&gt;
## 1       mat_a mat_a_heatmap_body_1_1         1            1     7,5,2,...
## 2       mat_a mat_a_heatmap_body_1_2         1            2     7,5,2,...
##    column_index
##   &lt;IntegerList&gt;
## 1         7,3,5
## 2             6</code></pre>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="interactive.html#cb637-1"></a><span class="co"># remember to dev.off()</span></span></code></pre></div>
<p>Normally, users do not need to use it directly, however, it is very useful
when developing a Shiny app where the plot is actually under a non-interactive
graphics device. I will explain in the next section.</p>
</div>
<div id="shiny-app" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Shiny app</h2>
<p>With the three functions <code>ht_pos_on_device()</code>, <code>selectPosition()</code> and <code>selectArea()</code>,
it is possible to implement Shiny apps for interactively working with heatmaps.
<strong>ComplexHeatmap now has a <code>ht_shiny()</code> function which directly exports a heatmap
(or a heatmap list) into a Shiny app.</strong></p>
<p>To use <code>ht_shiny()</code>, the <code>Heatmap</code>/<code>HeatmapList</code> object is not necessary to be
updated with <code>draw()</code>, however, updating by <code>draw()</code> will speed up the loading
of the Shiny app because <code>draw()</code> applies clustering saves it into the heatmap object.</p>
<p>To export the <code>ht_list</code> that is already generated into a Shiny app, simply
execute <code>ht_shiny()</code> as following. Please visit
<a href="https://jokergoo.shinyapps.io/interactive_complexheatmap/" class="uri">https://jokergoo.shinyapps.io/interactive_complexheatmap/</a> for a live demo.</p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="interactive.html#cb638-1"></a><span class="kw">ht_shiny</span>(ht_list)</span></code></pre></div>
<p>The following code demostrates two vertically concatenated heatmaps. Check
<a href="https://jokergoo.shinyapps.io/interactive_complexheatmap_vertical/" class="uri">https://jokergoo.shinyapps.io/interactive_complexheatmap_vertical/</a> for a live demo.</p>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb639-1"><a href="interactive.html#cb639-1"></a>ht_list =<span class="st"> </span><span class="kw">Heatmap</span>(mat1, <span class="dt">name =</span> <span class="st">&quot;mat_a&quot;</span>, <span class="dt">row_km =</span> <span class="dv">2</span>, <span class="dt">column_km =</span> <span class="dv">2</span>) <span class="op">%v%</span></span>
<span id="cb639-2"><a href="interactive.html#cb639-2"></a><span class="st">    </span><span class="kw">Heatmap</span>(mat2, <span class="dt">name =</span> <span class="st">&quot;mat_b&quot;</span>)</span>
<span id="cb639-3"><a href="interactive.html#cb639-3"></a><span class="kw">ht_shiny</span>(ht_list)</span></code></pre></div>
<p><code>densityHeatmap()</code> returns a <code>Heatmap</code> object, thus it can also be exported into a Shiny app.
Check <a href="https://jokergoo.shinyapps.io/interactive_densityheatmap/" class="uri">https://jokergoo.shinyapps.io/interactive_densityheatmap/</a> for a live demo.</p>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb640-1"><a href="interactive.html#cb640-1"></a>ht =<span class="st"> </span><span class="kw">densityHeatmap</span>(mat1)</span>
<span id="cb640-2"><a href="interactive.html#cb640-2"></a><span class="kw">ht_shiny</span>(ht)</span></code></pre></div>
<p><a href="https://www.bioconductor.org/packages/release/bioc/html/EnrichedHeatmap.html"><strong>EnrichedHeatmap</strong></a> also outputs <code>Heatmap</code> objects, thus, an “enriched heatmap” can be exported
into a Shiny app as well. Check <a href="https://jokergoo.shinyapps.io/interactive_enrichedheatmap/" class="uri">https://jokergoo.shinyapps.io/interactive_enrichedheatmap/</a> for a live demo.</p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="interactive.html#cb641-1"></a><span class="kw">library</span>(EnrichedHeatmap)</span>
<span id="cb641-2"><a href="interactive.html#cb641-2"></a><span class="kw">load</span>(<span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;chr21_test_data.RData&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;EnrichedHeatmap&quot;</span>))</span>
<span id="cb641-3"><a href="interactive.html#cb641-3"></a>mat_meth =<span class="st"> </span><span class="kw">normalizeToMatrix</span>(meth, cgi, <span class="dt">value_column =</span> <span class="st">&quot;meth&quot;</span>, </span>
<span id="cb641-4"><a href="interactive.html#cb641-4"></a>	<span class="dt">mean_mode =</span> <span class="st">&quot;absolute&quot;</span>, <span class="dt">extend =</span> <span class="dv">5000</span>, <span class="dt">w =</span> <span class="dv">50</span>, <span class="dt">smooth =</span> <span class="ot">TRUE</span>)</span>
<span id="cb641-5"><a href="interactive.html#cb641-5"></a>ht =<span class="st"> </span><span class="kw">EnrichedHeatmap</span>(mat_meth, <span class="dt">name =</span> <span class="st">&quot;methylation&quot;</span>, </span>
<span id="cb641-6"><a href="interactive.html#cb641-6"></a>	<span class="dt">column_title =</span> <span class="st">&quot;methylation near CGI&quot;</span>)</span>
<span id="cb641-7"><a href="interactive.html#cb641-7"></a><span class="kw">ht_shiny</span>(ht)</span></code></pre></div>
<p>Since <strong>ComplexHeatmap</strong> can <a href="http://127.0.0.1:6058/2020/05/06/translate-from-pheatmap-to-complexheatmap/">seamlessly integrate <strong>pheatmap</strong></a>, this means your pheatmap can be interactive!</p>
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb642-1"><a href="interactive.html#cb642-1"></a>ht =<span class="st"> </span><span class="kw">pheatmap</span>(mat1)</span>
<span id="cb642-2"><a href="interactive.html#cb642-2"></a><span class="kw">ht_shiny</span>(ht)</span></code></pre></div>
<p>Following screenshot demonstrates the Shiny app on rather complex heatmaps. The data is from <a href="http://jokergoo.github.io/supplementary/ComplexHeatmap-supplementary1-4/supplS2_scRNASeq/supplS2_scRNAseq.html">here</a> with slightly changing
the original code for making heatmaps.</p>
<p>In this Shiny app, users can click on the orignal heatmap or select an area
from it. The information of the area selected by users can be found in the
text below the heatmaps. If an area is selected, the row and column indices
for all selected heatmaps can be obtained from a automatically generated
sourcable code, which can also be found below the heatmap. Both heatmaps can
be resized by dragging from the bottom right.</p>
<p>
<img width='100%' style='border:1px solid grey;padding: 4px;'  src='https://user-images.githubusercontent.com/449218/82199376-e5eec600-98fd-11ea-9fca-ad95d405dc20.gif' />
</p>
<p>Please note, if the heatmap is too huge or you resize the heatmap too
frequently, the heatmap might not be correctly updated. You can just slightly
resize the heatmap again and wait for several seconds (you might have already observed
from the previous screenshot that the right heatmap was not properly drawn when I first
resized it).</p>
<p>The sub-heatmap visualized on the right side in the Shiny app will not contain
anything drawn from <code>cell_fun</code>/<code>layer_fun</code> or <code>decorate_*()</code> functions, which
means you cannot export an
<a href="https://jokergoo.github.io/ComplexHeatmap-reference/book/oncoprint.html">oncoPrint</a>
or a <a href="https://jokergoo.github.io/ComplexHeatmap-reference/book/upset-plot.html">UpSet plot</a> into a Shiny app.</p>
</div>
<div id="implement-a-shiny-app-from-scratch" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Implement a Shiny app from scratch</h2>
<p>Next I will demonstrate how to build a Shiny app from scratch with
<code>ht_pos_on_device()</code>, <code>selectPosition()</code> and <code>selectArea()</code>. First I provide
a runnable example, and later I explain it step by step. In this example, I
only use a single heatmap for simplicity.</p>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb643-1"><a href="interactive.html#cb643-1"></a><span class="co"># you can copy the following code and paste into your R session, the app runs.</span></span>
<span id="cb643-2"><a href="interactive.html#cb643-2"></a><span class="kw">library</span>(shiny)</span>
<span id="cb643-3"><a href="interactive.html#cb643-3"></a><span class="kw">library</span>(glue)</span>
<span id="cb643-4"><a href="interactive.html#cb643-4"></a><span class="kw">library</span>(ComplexHeatmap)</span>
<span id="cb643-5"><a href="interactive.html#cb643-5"></a></span>
<span id="cb643-6"><a href="interactive.html#cb643-6"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb643-7"><a href="interactive.html#cb643-7"></a>mat =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dv">10</span>)</span>
<span id="cb643-8"><a href="interactive.html#cb643-8"></a><span class="kw">rownames</span>(mat) =<span class="st"> </span><span class="kw">colnames</span>(mat) =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb643-9"><a href="interactive.html#cb643-9"></a></span>
<span id="cb643-10"><a href="interactive.html#cb643-10"></a>ht =<span class="st"> </span><span class="kw">Heatmap</span>(mat, <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>)</span>
<span id="cb643-11"><a href="interactive.html#cb643-11"></a></span>
<span id="cb643-12"><a href="interactive.html#cb643-12"></a>ui =<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb643-13"><a href="interactive.html#cb643-13"></a>    <span class="kw">fluidRow</span>(</span>
<span id="cb643-14"><a href="interactive.html#cb643-14"></a>        <span class="kw">column</span>(<span class="dt">width =</span> <span class="dv">3</span>,</span>
<span id="cb643-15"><a href="interactive.html#cb643-15"></a>            <span class="kw">plotOutput</span>(<span class="st">&quot;main_heatmap&quot;</span>, <span class="dt">height =</span> <span class="dv">300</span>, <span class="dt">width =</span> <span class="dv">300</span>,</span>
<span id="cb643-16"><a href="interactive.html#cb643-16"></a>                <span class="dt">brush =</span> <span class="st">&quot;ht_brush&quot;</span>, <span class="dt">click =</span> <span class="st">&quot;ht_click&quot;</span>)</span>
<span id="cb643-17"><a href="interactive.html#cb643-17"></a>        ),</span>
<span id="cb643-18"><a href="interactive.html#cb643-18"></a>        <span class="kw">column</span>(<span class="dt">width =</span> <span class="dv">3</span>,</span>
<span id="cb643-19"><a href="interactive.html#cb643-19"></a>          <span class="kw">plotOutput</span>(<span class="st">&quot;sub_heatmap&quot;</span>, <span class="dt">height =</span> <span class="dv">300</span>, <span class="dt">width =</span> <span class="dv">300</span>)</span>
<span id="cb643-20"><a href="interactive.html#cb643-20"></a>        )</span>
<span id="cb643-21"><a href="interactive.html#cb643-21"></a>    ),</span>
<span id="cb643-22"><a href="interactive.html#cb643-22"></a>    <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;ht_click_content&quot;</span>)</span>
<span id="cb643-23"><a href="interactive.html#cb643-23"></a>)</span>
<span id="cb643-24"><a href="interactive.html#cb643-24"></a></span>
<span id="cb643-25"><a href="interactive.html#cb643-25"></a>shiny_env =<span class="st"> </span><span class="kw">new.env</span>()</span>
<span id="cb643-26"><a href="interactive.html#cb643-26"></a>server =<span class="st"> </span><span class="cf">function</span>(input, output) {</span>
<span id="cb643-27"><a href="interactive.html#cb643-27"></a>    output<span class="op">$</span>main_heatmap =<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb643-28"><a href="interactive.html#cb643-28"></a>        shiny_env<span class="op">$</span>ht =<span class="st"> </span><span class="kw">draw</span>(ht)</span>
<span id="cb643-29"><a href="interactive.html#cb643-29"></a>        shiny_env<span class="op">$</span>ht_pos =<span class="st"> </span><span class="kw">ht_pos_on_device</span>(shiny_env<span class="op">$</span>ht)</span>
<span id="cb643-30"><a href="interactive.html#cb643-30"></a>    })</span>
<span id="cb643-31"><a href="interactive.html#cb643-31"></a></span>
<span id="cb643-32"><a href="interactive.html#cb643-32"></a>    output<span class="op">$</span>sub_heatmap =<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb643-33"><a href="interactive.html#cb643-33"></a>        <span class="cf">if</span>(<span class="kw">is.null</span>(input<span class="op">$</span>ht_brush)) {</span>
<span id="cb643-34"><a href="interactive.html#cb643-34"></a>            <span class="kw">grid.newpage</span>()</span>
<span id="cb643-35"><a href="interactive.html#cb643-35"></a>            <span class="kw">grid.text</span>(<span class="st">&quot;No region is selected.&quot;</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>)</span>
<span id="cb643-36"><a href="interactive.html#cb643-36"></a>        } <span class="cf">else</span> {</span>
<span id="cb643-37"><a href="interactive.html#cb643-37"></a>            lt =<span class="st"> </span>ComplexHeatmap<span class="op">:::</span><span class="kw">get_pos_from_brush</span>(input<span class="op">$</span>ht_brush)</span>
<span id="cb643-38"><a href="interactive.html#cb643-38"></a>            pos1 =<span class="st"> </span>lt[[<span class="dv">1</span>]]</span>
<span id="cb643-39"><a href="interactive.html#cb643-39"></a>            pos2 =<span class="st"> </span>lt[[<span class="dv">2</span>]]</span>
<span id="cb643-40"><a href="interactive.html#cb643-40"></a>            </span>
<span id="cb643-41"><a href="interactive.html#cb643-41"></a>            ht =<span class="st"> </span>shiny_env<span class="op">$</span>ht</span>
<span id="cb643-42"><a href="interactive.html#cb643-42"></a>            pos =<span class="st"> </span><span class="kw">selectArea</span>(ht, <span class="dt">mark =</span> <span class="ot">FALSE</span>, <span class="dt">pos1 =</span> pos1, <span class="dt">pos2 =</span> pos2, </span>
<span id="cb643-43"><a href="interactive.html#cb643-43"></a>                <span class="dt">verbose =</span> <span class="ot">FALSE</span>, <span class="dt">ht_pos =</span> shiny_env<span class="op">$</span>ht_pos)</span>
<span id="cb643-44"><a href="interactive.html#cb643-44"></a>            </span>
<span id="cb643-45"><a href="interactive.html#cb643-45"></a>            row_index =<span class="st"> </span><span class="kw">unlist</span>(pos[<span class="dv">1</span>, <span class="st">&quot;row_index&quot;</span>])</span>
<span id="cb643-46"><a href="interactive.html#cb643-46"></a>            column_index =<span class="st"> </span><span class="kw">unlist</span>(pos[<span class="dv">1</span>, <span class="st">&quot;column_index&quot;</span>])</span>
<span id="cb643-47"><a href="interactive.html#cb643-47"></a>            m =<span class="st"> </span>ht<span class="op">@</span>ht_list[[<span class="dv">1</span>]]<span class="op">@</span>matrix</span>
<span id="cb643-48"><a href="interactive.html#cb643-48"></a>            ht_select =<span class="st"> </span><span class="kw">Heatmap</span>(m[row_index, column_index, <span class="dt">drop =</span> <span class="ot">FALSE</span>],</span>
<span id="cb643-49"><a href="interactive.html#cb643-49"></a>                <span class="dt">col =</span> ht<span class="op">@</span>ht_list[[<span class="dv">1</span>]]<span class="op">@</span>matrix_color_mapping<span class="op">@</span>col_fun,</span>
<span id="cb643-50"><a href="interactive.html#cb643-50"></a>                <span class="dt">show_heatmap_legend =</span> <span class="ot">FALSE</span>,</span>
<span id="cb643-51"><a href="interactive.html#cb643-51"></a>                <span class="dt">cluster_rows =</span> <span class="ot">FALSE</span>, <span class="dt">cluster_columns =</span> <span class="ot">FALSE</span>)</span>
<span id="cb643-52"><a href="interactive.html#cb643-52"></a>            <span class="kw">draw</span>(ht_select)</span>
<span id="cb643-53"><a href="interactive.html#cb643-53"></a>        }</span>
<span id="cb643-54"><a href="interactive.html#cb643-54"></a>    })</span>
<span id="cb643-55"><a href="interactive.html#cb643-55"></a></span>
<span id="cb643-56"><a href="interactive.html#cb643-56"></a>    output<span class="op">$</span>ht_click_content =<span class="st"> </span><span class="kw">renderText</span>({</span>
<span id="cb643-57"><a href="interactive.html#cb643-57"></a>        <span class="cf">if</span>(<span class="kw">is.null</span>(input<span class="op">$</span>ht_click)) {</span>
<span id="cb643-58"><a href="interactive.html#cb643-58"></a>            <span class="st">&quot;Not selected.&quot;</span></span>
<span id="cb643-59"><a href="interactive.html#cb643-59"></a>        } <span class="cf">else</span> {</span>
<span id="cb643-60"><a href="interactive.html#cb643-60"></a>            pos1 =<span class="st"> </span>ComplexHeatmap<span class="op">:::</span><span class="kw">get_pos_from_click</span>(input<span class="op">$</span>ht_click)</span>
<span id="cb643-61"><a href="interactive.html#cb643-61"></a>            </span>
<span id="cb643-62"><a href="interactive.html#cb643-62"></a>            ht =<span class="st"> </span>shiny_env<span class="op">$</span>ht</span>
<span id="cb643-63"><a href="interactive.html#cb643-63"></a>            pos =<span class="st"> </span><span class="kw">selectPosition</span>(ht, <span class="dt">mark =</span> <span class="ot">FALSE</span>, <span class="dt">pos =</span> pos1, </span>
<span id="cb643-64"><a href="interactive.html#cb643-64"></a>                <span class="dt">verbose =</span> <span class="ot">FALSE</span>, <span class="dt">ht_pos =</span> shiny_env<span class="op">$</span>ht_pos)</span>
<span id="cb643-65"><a href="interactive.html#cb643-65"></a>            </span>
<span id="cb643-66"><a href="interactive.html#cb643-66"></a>            row_index =<span class="st"> </span>pos[<span class="dv">1</span>, <span class="st">&quot;row_index&quot;</span>]</span>
<span id="cb643-67"><a href="interactive.html#cb643-67"></a>            column_index =<span class="st"> </span>pos[<span class="dv">1</span>, <span class="st">&quot;column_index&quot;</span>]</span>
<span id="cb643-68"><a href="interactive.html#cb643-68"></a>            m =<span class="st"> </span>ht<span class="op">@</span>ht_list[[<span class="dv">1</span>]]<span class="op">@</span>matrix</span>
<span id="cb643-69"><a href="interactive.html#cb643-69"></a>            v =<span class="st"> </span>m[row_index, column_index]</span>
<span id="cb643-70"><a href="interactive.html#cb643-70"></a>            </span>
<span id="cb643-71"><a href="interactive.html#cb643-71"></a>            <span class="kw">glue</span>(<span class="st">&quot;row index: {row_index}&quot;</span>,</span>
<span id="cb643-72"><a href="interactive.html#cb643-72"></a>                 <span class="st">&quot;column index: {column_index}&quot;</span>,</span>
<span id="cb643-73"><a href="interactive.html#cb643-73"></a>                 <span class="st">&quot;value: {v}&quot;</span>, <span class="dt">.sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb643-74"><a href="interactive.html#cb643-74"></a>        }</span>
<span id="cb643-75"><a href="interactive.html#cb643-75"></a>    })</span>
<span id="cb643-76"><a href="interactive.html#cb643-76"></a>}</span>
<span id="cb643-77"><a href="interactive.html#cb643-77"></a></span>
<span id="cb643-78"><a href="interactive.html#cb643-78"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>The UI of the app is simple. The left is the original heatmap which allows
clicking and brushing, and the right is the heatmap for the sub-matrix
selected. Below the heatmap is a text area which provides information for the
selected area.</p>
<div class="sourceCode" id="cb644"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb644-1"><a href="interactive.html#cb644-1"></a>ui =<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb644-2"><a href="interactive.html#cb644-2"></a>    <span class="kw">fluidRow</span>(</span>
<span id="cb644-3"><a href="interactive.html#cb644-3"></a>        <span class="kw">column</span>(<span class="dt">width =</span> <span class="dv">3</span>,</span>
<span id="cb644-4"><a href="interactive.html#cb644-4"></a>            <span class="kw">plotOutput</span>(<span class="st">&quot;main_heatmap&quot;</span>, <span class="dt">height =</span> <span class="dv">300</span>, <span class="dt">width =</span> <span class="dv">300</span>,</span>
<span id="cb644-5"><a href="interactive.html#cb644-5"></a>                <span class="dt">brush =</span> <span class="st">&quot;ht_brush&quot;</span>, <span class="dt">click =</span> <span class="st">&quot;ht_click&quot;</span>)</span>
<span id="cb644-6"><a href="interactive.html#cb644-6"></a>        ),</span>
<span id="cb644-7"><a href="interactive.html#cb644-7"></a>        <span class="kw">column</span>(<span class="dt">width =</span> <span class="dv">3</span>,</span>
<span id="cb644-8"><a href="interactive.html#cb644-8"></a>          <span class="kw">plotOutput</span>(<span class="st">&quot;sub_heatmap&quot;</span>, <span class="dt">height =</span> <span class="dv">300</span>, <span class="dt">width =</span> <span class="dv">300</span>)</span>
<span id="cb644-9"><a href="interactive.html#cb644-9"></a>        )</span>
<span id="cb644-10"><a href="interactive.html#cb644-10"></a>    ),</span>
<span id="cb644-11"><a href="interactive.html#cb644-11"></a>    <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;ht_click_content&quot;</span>)</span>
<span id="cb644-12"><a href="interactive.html#cb644-12"></a>)</span></code></pre></div>
<p>Here we have an environment to put global variables in, that can be shared
between different Shiny components.</p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="interactive.html#cb645-1"></a>shiny_env =<span class="st"> </span><span class="kw">new.env</span>()</span></code></pre></div>
<p>Once the app is lanched, the heatmap is drawn. Here if <code>ht</code> has not been
previously updated by <code>draw()</code>, the <code>draw()</code> inside <code>renderPlot()</code> will also
perform clustering, or else it only redraws the heatmap.</p>
<p>Once the heatmap is drawn, the heatmap will not change, thus, we save the
heatmap object (returned by <code>draw()</code> where clustering is done and layout is
initialized) as well as the positions of heatmap in the image (<code>ht_opt</code>) as
global variables.</p>
<div class="sourceCode" id="cb646"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb646-1"><a href="interactive.html#cb646-1"></a>	output<span class="op">$</span>main_heatmap =<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb646-2"><a href="interactive.html#cb646-2"></a>        shiny_env<span class="op">$</span>ht =<span class="st"> </span><span class="kw">draw</span>(ht)</span>
<span id="cb646-3"><a href="interactive.html#cb646-3"></a>        shiny_env<span class="op">$</span>ht_pos =<span class="st"> </span><span class="kw">ht_pos_on_device</span>(shiny_env<span class="op">$</span>ht)</span>
<span id="cb646-4"><a href="interactive.html#cb646-4"></a>    })</span></code></pre></div>
<p>The next following code defines the action when user selects an area from the
original heatmap. The variable <code>input$ht_brush</code> contains the position of the
selected area in the heatmap image. Here the <code>ComplexHeatmap:::get_pos_from_brush()</code>
is a simple function which retrieves the positions and saves them as
<code>grid::unit</code> objects.</p>
<p>In the code, <code>lt[[1]]</code> and <code>lt[[2]]</code> contain coordinates of the two
diagonal points that user selected. The two coordinates are sent to
<code>selectArea()</code> where <code>ht_pos</code> is also specified so that the heatmap positions
are not repeatedly calculated. Finally the row and column indicies can be
retrieved and the sub-heatmap is made.</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="interactive.html#cb647-1"></a>	output<span class="op">$</span>sub_heatmap =<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb647-2"><a href="interactive.html#cb647-2"></a>        <span class="cf">if</span>(<span class="kw">is.null</span>(input<span class="op">$</span>ht_brush)) {</span>
<span id="cb647-3"><a href="interactive.html#cb647-3"></a>            <span class="kw">grid.newpage</span>()</span>
<span id="cb647-4"><a href="interactive.html#cb647-4"></a>            <span class="kw">grid.text</span>(<span class="st">&quot;No region is selected.&quot;</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>)</span>
<span id="cb647-5"><a href="interactive.html#cb647-5"></a>        } <span class="cf">else</span> {</span>
<span id="cb647-6"><a href="interactive.html#cb647-6"></a>            lt =<span class="st"> </span>ComplexHeatmap<span class="op">:::</span><span class="kw">get_pos_from_brush</span>(input<span class="op">$</span>ht_brush)</span>
<span id="cb647-7"><a href="interactive.html#cb647-7"></a>            pos1 =<span class="st"> </span>lt[[<span class="dv">1</span>]]</span>
<span id="cb647-8"><a href="interactive.html#cb647-8"></a>            pos2 =<span class="st"> </span>lt[[<span class="dv">2</span>]]</span>
<span id="cb647-9"><a href="interactive.html#cb647-9"></a>            </span>
<span id="cb647-10"><a href="interactive.html#cb647-10"></a>            ht =<span class="st"> </span>shiny_env<span class="op">$</span>ht</span>
<span id="cb647-11"><a href="interactive.html#cb647-11"></a>            pos =<span class="st"> </span><span class="kw">selectArea</span>(ht, <span class="dt">mark =</span> <span class="ot">FALSE</span>, <span class="dt">pos1 =</span> pos1, <span class="dt">pos2 =</span> pos2, </span>
<span id="cb647-12"><a href="interactive.html#cb647-12"></a>                <span class="dt">verbose =</span> <span class="ot">FALSE</span>, <span class="dt">ht_pos =</span> shiny_env<span class="op">$</span>ht_pos)</span>
<span id="cb647-13"><a href="interactive.html#cb647-13"></a>            </span>
<span id="cb647-14"><a href="interactive.html#cb647-14"></a>            row_index =<span class="st"> </span><span class="kw">unlist</span>(pos[<span class="dv">1</span>, <span class="st">&quot;row_index&quot;</span>])</span>
<span id="cb647-15"><a href="interactive.html#cb647-15"></a>            column_index =<span class="st"> </span><span class="kw">unlist</span>(pos[<span class="dv">1</span>, <span class="st">&quot;column_index&quot;</span>])</span>
<span id="cb647-16"><a href="interactive.html#cb647-16"></a>            m =<span class="st"> </span>ht<span class="op">@</span>ht_list[[<span class="dv">1</span>]]<span class="op">@</span>matrix</span>
<span id="cb647-17"><a href="interactive.html#cb647-17"></a>            ht_select =<span class="st"> </span><span class="kw">Heatmap</span>(m[row_index, column_index, <span class="dt">drop =</span> <span class="ot">FALSE</span>],</span>
<span id="cb647-18"><a href="interactive.html#cb647-18"></a>                <span class="dt">col =</span> ht<span class="op">@</span>ht_list[[<span class="dv">1</span>]]<span class="op">@</span>matrix_color_mapping<span class="op">@</span>col_fun,</span>
<span id="cb647-19"><a href="interactive.html#cb647-19"></a>                <span class="dt">show_heatmap_legend =</span> <span class="ot">FALSE</span>,</span>
<span id="cb647-20"><a href="interactive.html#cb647-20"></a>                <span class="dt">cluster_rows =</span> <span class="ot">FALSE</span>, <span class="dt">cluster_columns =</span> <span class="ot">FALSE</span>)</span>
<span id="cb647-21"><a href="interactive.html#cb647-21"></a>            <span class="kw">draw</span>(ht_select)</span>
<span id="cb647-22"><a href="interactive.html#cb647-22"></a>        }</span>
<span id="cb647-23"><a href="interactive.html#cb647-23"></a>    })</span></code></pre></div>
<p>The following code defines the action when user click a position on the
original heatmap. Similar as <code>ComplexHeatmap:::get_pos_from_brush()</code>,
<code>ComplexHeatmap:::get_pos_from_click()</code> returns the clicked position in the
image.</p>
<p>Similarly, the position is sent to <code>selectPosition()</code>, and the row and column
index that correspond to the clicked position can be retrieved.</p>
<div class="sourceCode" id="cb648"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb648-1"><a href="interactive.html#cb648-1"></a>	output<span class="op">$</span>ht_click_content =<span class="st"> </span><span class="kw">renderText</span>({</span>
<span id="cb648-2"><a href="interactive.html#cb648-2"></a>        <span class="cf">if</span>(<span class="kw">is.null</span>(input<span class="op">$</span>ht_click)) {</span>
<span id="cb648-3"><a href="interactive.html#cb648-3"></a>            <span class="st">&quot;Not selected.&quot;</span></span>
<span id="cb648-4"><a href="interactive.html#cb648-4"></a>        } <span class="cf">else</span> {</span>
<span id="cb648-5"><a href="interactive.html#cb648-5"></a>            pos1 =<span class="st"> </span>ComplexHeatmap<span class="op">:::</span><span class="kw">get_pos_from_click</span>(input<span class="op">$</span>ht_click)</span>
<span id="cb648-6"><a href="interactive.html#cb648-6"></a>            </span>
<span id="cb648-7"><a href="interactive.html#cb648-7"></a>            ht =<span class="st"> </span>shiny_env<span class="op">$</span>ht</span>
<span id="cb648-8"><a href="interactive.html#cb648-8"></a>            pos =<span class="st"> </span><span class="kw">selectPosition</span>(ht, <span class="dt">mark =</span> <span class="ot">FALSE</span>, <span class="dt">pos =</span> pos1, </span>
<span id="cb648-9"><a href="interactive.html#cb648-9"></a>                <span class="dt">verbose =</span> <span class="ot">FALSE</span>, <span class="dt">ht_pos =</span> shiny_env<span class="op">$</span>ht_pos)</span>
<span id="cb648-10"><a href="interactive.html#cb648-10"></a>            </span>
<span id="cb648-11"><a href="interactive.html#cb648-11"></a>            row_index =<span class="st"> </span>pos[<span class="dv">1</span>, <span class="st">&quot;row_index&quot;</span>]</span>
<span id="cb648-12"><a href="interactive.html#cb648-12"></a>            column_index =<span class="st"> </span>pos[<span class="dv">1</span>, <span class="st">&quot;column_index&quot;</span>]</span>
<span id="cb648-13"><a href="interactive.html#cb648-13"></a>            m =<span class="st"> </span>ht<span class="op">@</span>ht_list[[<span class="dv">1</span>]]<span class="op">@</span>matrix</span>
<span id="cb648-14"><a href="interactive.html#cb648-14"></a>            v =<span class="st"> </span>m[row_index, column_index]</span>
<span id="cb648-15"><a href="interactive.html#cb648-15"></a>            </span>
<span id="cb648-16"><a href="interactive.html#cb648-16"></a>            <span class="kw">glue</span>(<span class="st">&quot;row index: {row_index}&quot;</span>,</span>
<span id="cb648-17"><a href="interactive.html#cb648-17"></a>                 <span class="st">&quot;column index: {column_index}&quot;</span>,</span>
<span id="cb648-18"><a href="interactive.html#cb648-18"></a>                 <span class="st">&quot;value: {v}&quot;</span>, <span class="dt">.sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb648-19"><a href="interactive.html#cb648-19"></a>        }</span>
<span id="cb648-20"><a href="interactive.html#cb648-20"></a>    })</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="upset-plot.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="integrate-with-other-packages.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jokergoo/ComplexHeatmap-reference/edit/master/09-interactive.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
